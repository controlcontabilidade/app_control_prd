{% extends "base.html" %}

<!-- Macro para remover máscaras de CPF/CNPJ (manter apenas números) -->
{% macro remove_mask(text) -%}
{{ text|replace('.', '')|replace('-', '')|replace('/', '')|replace(' ', '')|replace('(', '')|replace(')', '') if text else '' }}
{%- endmacro %}

{% block title %}{{ client.nomeEmpresa }} – SiGEC{% endblock %}

{% block content %}
<!-- Header da página -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1>
                <i class="bi bi-eye" style="color: var(--control-primary);"></i>
                {{ client.nomeEmpresa }}
            </h1>
            <p class="mb-2">
                {% if client.nomeFantasiaReceita and client.nomeFantasiaReceita != client.nomeEmpresa %}
                    <strong>Nome Fantasia:</strong> {{ client.nomeFantasiaReceita }}
                {% else %}
                    SIGEC - Sistema de Gestão de Empresas Control - Visualização completa do cliente
                {% endif %}
            </p>
            <div class="d-flex gap-2 align-items-center">
                {% set status = client.get('statusCliente', 'ativo')|lower %}
                {% if status == 'ativo' %}
                    <span class="status-indicator">
                        <span class="status-dot active"></span>
                        <strong class="text-success">Cliente Ativo</strong>
                    </span>
                {% else %}
                    <span class="status-indicator">
                        <span class="status-dot inactive"></span>
                        <strong class="text-muted">Cliente Inativo</strong>
                    </span>
                {% endif %}
                {% if client.cnpj %}
                    <span class="text-muted">•</span>
                    <code class="text-muted">{{ client.cnpj }}</code>
                {% endif %}
                {% if client.cidade %}
                    <span class="text-muted">•</span>
                    <span class="text-muted">{{ client.cidade }}</span>
                {% endif %}
            </div>
        </div>
        <div class="col-md-4 text-end">
            <a href="/client/{{ client.id }}/edit" class="btn btn-primary me-2">
                <i class="bi bi-pencil"></i>
                Editar
            </a>
            <a href="/" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i>
                Voltar
            </a>
        </div>
    </div>
</div>

<div class="row">
    <!-- Coluna principal - 8 colunas -->
    <div class="col-lg-8">
        <!-- Bloco 1: Informações da Pessoa Física / Jurídica -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-user-tie me-2"></i>
                    Informações da Pessoa Física / Jurídica
                </h5>
            </div>
            <div class="card-body">
                                <div class="container-fluid px-0">
                                                        <div class="row g-3">
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Nome da Empresa</label>
                                                                <p class="mb-0"><strong>{{ client.nomeEmpresa or '-' }}</strong></p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Razão Social (Receita)</label>
                                                                <p class="mb-0">{{ client.razaoSocialReceita or '-' }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Nome Fantasia (Receita)</label>
                                                                <p class="mb-0">{{ client.nomeFantasiaReceita or '-' }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">CPF/CNPJ</label>
                                                                <p class="mb-0"><code class="text-dark">{{ remove_mask(client.cpfCnpj or client.cnpj) }}</code></p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Inscrição Estadual</label>
                                                                <p class="mb-0">{{ client.inscEst or '-' }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Inscrição Municipal</label>
                                                                <p class="mb-0">{{ client.inscMun or '-' }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Cidade</label>
                                                                <p class="mb-0">{{ client.cidade or '-' }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Estado</label>
                                                                <p class="mb-0"><span class="badge bg-primary">{{ (client.estado or '-')|upper }}</span></p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Regime Federal</label>
                                                                <p class="mb-0"><span class="badge bg-secondary">{{ (client.regimeFederal or client.tributacao or '-')|upper }}</span></p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Regime Estadual</label>
                                                                <p class="mb-0"><span class="badge bg-secondary">{{ (client.regimeEstadual or '-')|upper }}</span></p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Segmento</label>
                                                                <p class="mb-0">{{ client.segmento or '-' }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label text-muted">Atividade Principal</label>
                                                                <p class="mb-0">{{ client.atividade or '-' }}</p>
                                                            </div>
                                                        </div>
                                </div>
            </div>
        </div>

        <!-- Bloco 3: Quadro Societário -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-users me-2"></i>
                    Quadro Societário
                </h5>
            </div>
            <div class="card-body">
                {% set socios_existentes = [] %}
                {% for i in range(1, 11) %}
                    {% set socio_nome = client.get('socio_' ~ i ~ '_nome') or client.get('socio' ~ i ~ '_nome') or client.get('socio' ~ i ~ 'Nome') or client.get('socio' ~ i) %}
                    {% if socio_nome %}
                        {% set _ = socios_existentes.append(socio_nome) %}
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6 class="text-primary">
                                    <i class="fas fa-user me-2"></i>
                                    Sócio {{ i }}
                                </h6>
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label text-muted">Nome</label>
                                <p class="mb-0"><strong>{{ socio_nome|upper }}</strong></p>
                            </div>
                            {% set socio_cpf = client.get('socio_' ~ i ~ '_cpf') or client.get('socio' ~ i ~ '_cpf') or client.get('socio' ~ i ~ 'Cpf') %}
                            {% if socio_cpf %}
                            <div class="col-md-6 mb-2">
                                <label class="form-label text-muted">CPF</label>
                                <p class="mb-0"><code class="text-dark">{{ socio_cpf }}</code></p>
                            </div>
                            {% endif %}
                            {% set socio_nasc = client.get('socio_' ~ i ~ '_data_nascimento') or client.get('socio_' ~ i ~ '_dataNascimento') or client.get('socio' ~ i ~ '_nascimento') or client.get('socio' ~ i ~ 'DataNascimento') %}
                            {% if socio_nasc %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Data Nascimento</label>
                                <p class="mb-0">{{ socio_nasc|format_date if socio_nasc else socio_nasc }}</p>
                            </div>
                            {% endif %}
                            {% set socio_cotas = client.get('socio_' ~ i ~ '_cotas') or client.get('socio' ~ i ~ '_quotas') or client.get('socio' ~ i ~ 'Cotas') %}
                            {% if socio_cotas %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Cotas</label>
                                <p class="mb-0"><strong>{{ socio_cotas }}</strong></p>
                            </div>
                            {% endif %}
                            {% set socio_admin = client.get('socio_' ~ i ~ '_administrador') or client.get('socio' ~ i ~ '_admin') or client.get('socio' ~ i ~ 'Admin') %}
                            {% if socio_admin %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Administrador</label>
                                <p class="mb-0"><span class="badge bg-success">{{ 'SIM' if socio_admin else 'NÃO' }}</span></p>
                            </div>
                            {% endif %}
                            {% set socio_part = client.get('socio_' ~ i ~ '_participacao') or client.get('socio' ~ i ~ '_cotas') or client.get('socio' ~ i ~ 'Cotas') %}
                            {% if socio_part %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">% Participação</label>
                                <p class="mb-0">{{ socio_part }}%</p>
                            </div>
                            {% endif %}
                            {% set socio_resp = client.get('socio_' ~ i ~ '_resp_legal') or client.get('socio' ~ i ~ '_respLegal') %}
                            {% if socio_resp %}
                            <div class="col-md-4 mb-2">
                                <label class="form-label text-muted">Responsável Legal</label>
                                <p class="mb-0"><span class="badge bg-info">{{ 'SIM' if socio_resp else 'NÃO' }}</span></p>
                            </div>
                            {% endif %}
                        </div>
                        {% if not loop.last %}<hr>{% endif %}
                    {% endif %}
                {% endfor %}
                {% if socios_existentes|length == 0 %}
                    <p class="text-muted text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Nenhum sócio cadastrado
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Bloco 4: Contatos -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-address-book me-2"></i>
                    Contatos
                </h5>
            </div>
            <div class="card-body">
                {% set contatos_existentes = [] %}
                {% for i in range(1, 4) %}
                    {% set contato_nome = client.get('contato_' ~ i ~ '_nome') %}
                    {% set contato_telefone = client.get('contato_' ~ i ~ '_telefone') %}
                    {% set contato_email = client.get('contato_' ~ i ~ '_email') %}
                    {% set contato_cargo = client.get('contato_' ~ i ~ '_cargo') %}
                    
                    {# Filtra valores vazios ou "NÃO"/"NAO" #}
                    {% set nome_valido = contato_nome and contato_nome.strip() and contato_nome.upper() not in ['NÃO', 'NAO', 'N/A', '-'] %}
                    {% set telefone_valido = contato_telefone and contato_telefone.strip() and contato_telefone.upper() not in ['NÃO', 'NAO', 'N/A', '-'] %}
                    {% set email_valido = contato_email and contato_email.strip() and contato_email.upper() not in ['NÃO', 'NAO', 'N/A', '-'] %}
                    {% set cargo_valido = contato_cargo and contato_cargo.strip() and contato_cargo.upper() not in ['NÃO', 'NAO', 'N/A', '-'] %}
                    
                    {% if nome_valido or telefone_valido or email_valido or cargo_valido %}
                        {% set _ = contatos_existentes.append(i) %}
                        <div class="col-md-12 mb-4">
                            <h6 class="border-bottom pb-2 mb-3">Contato {{ i }}</h6>
                            <div class="row">
                                {% if nome_valido %}
                                <div class="col-md-3 mb-2">
                                    <label class="form-label text-muted">Nome</label>
                                    <p class="mb-0"><i class="bi bi-person me-1"></i>{{ contato_nome }}</p>
                                </div>
                                {% endif %}
                                {% if cargo_valido %}
                                <div class="col-md-3 mb-2">
                                    <label class="form-label text-muted">Cargo</label>
                                    <p class="mb-0"><i class="bi bi-briefcase me-1"></i>{{ contato_cargo }}</p>
                                </div>
                                {% endif %}
                                {% if telefone_valido %}
                                <div class="col-md-3 mb-2">
                                    <label class="form-label text-muted">Telefone</label>
                                    <p class="mb-0"><i class="bi bi-telephone me-1"></i>{{ contato_telefone }}</p>
                                </div>
                                {% endif %}
                                {% if email_valido %}
                                <div class="col-md-3 mb-2">
                                    <label class="form-label text-muted">E-mail</label>
                                    <p class="mb-0"><i class="bi bi-envelope me-1"></i>{{ contato_email }}</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                
                {% if contatos_existentes|length == 0 %}
                    <p class="text-muted text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Nenhum contato cadastrado
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Bloco 5: Senhas -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-key me-2"></i>
                    Senhas
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Informações Sensíveis</strong> - Dados de acesso confidenciais
                </div>

                <!-- Linha 1: CNPJ Acesso Simples Nacional, CPF do Representante Legal, Código de Acesso Simples Nacional, Senha ISS -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">CNPJ Acesso Simples Nacional</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.cnpjAcessoSn if client.cnpjAcessoSn else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">CPF do Representante Legal</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.cpfRepLegal if client.cpfRepLegal else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Código de Acesso Simples Nacional</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.codigoAcessoSn if client.codigoAcessoSn else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha ISS</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaIss if client.senhaIss else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 2: Senha SEFIN, Senha SEUMA, Acesso EmpWeb, Senha EmpWeb -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha SEFIN</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaSefin if client.senhaSefin else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha SEUMA</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaSeuma if client.senhaSeuma else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso EmpWeb</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoEmpWeb if client.acessoEmpWeb else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha EmpWeb</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaEmpWeb if client.senhaEmpWeb else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 3: Login ANVISA Empresa, Senha ANVISA Empresa, Login ANVISA Gestor, Senha ANVISA Gestor -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Login ANVISA Empresa</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.anvisaEmpresa if client.anvisaEmpresa else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha ANVISA Empresa</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaAnvisaEmpresa if client.senhaAnvisaEmpresa else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Login ANVISA Gestor</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.anvisaGestor if client.anvisaGestor else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha ANVISA Gestor</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaAnvisaGestor if client.senhaAnvisaGestor else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 4: Acesso CRF, Senha FAP/INSS, Senha CRF, E-mail SEFIN -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso CRF</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoCrf if client.acessoCrf else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha FAP/INSS</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaFapInss if client.senhaFapInss else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha CRF</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaCrf if client.senhaCrf else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">E-mail SEFIN</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.emailSefin if client.emailSefin else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 5: E-mail EmpWeb -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">E-mail EmpWeb</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.emailEmpweb if client.emailEmpweb else '-' }}</small></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bloco 6: Procurações -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-contract me-2"></i>
                    Procurações
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% set procuracoes = [
                        ('Proc. Receita', client.procReceita, client.dataProcReceita),
                        ('Proc. DTe', client.procDte, client.dataProcDte),
                        ('Proc. Caixa', client.procCaixa, client.dataProcCaixa),
                        ('Proc. Emp. Web', client.procEmpWeb, client.dataProcEmpWeb),
                        ('Proc. DET', client.procDet, client.dataProcDet)
                    ] %}
                    
                    {% for nome, ativa, data in procuracoes %}
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">{{ nome }}</label>
                            <p class="mb-0">
                                {% if ativa %}
                                    <span class="badge bg-success me-2">
                                        <i class="fas fa-check me-1"></i>ATIVA
                                    </span>
                                    {% if data %}
                                        <small class="text-muted">{{ data | format_date }}</small>
                                    {% endif %}
                                {% else %}
                                    <span class="badge bg-secondary me-2">
                                        <i class="fas fa-minus me-1"></i>SEM PROCURAÇÃO
                                    </span>
                                {% endif %}
                            </p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Bloco 7: Observações e Dados Adicionais -->
        <div class="card mb-4">
            <div class="card-header bg-light text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-sticky-note me-2"></i>
                    Observações e Dados Adicionais
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-12">
                        <label class="form-label text-muted">Observações Gerais</label>
                        <div class="bg-light p-3 rounded">
                            {% if client.observacoes and client.observacoes.strip() %}
                                <p class="mb-0" style="white-space: pre-wrap;">{{ client.observacoes }}</p>
                            {% else %}
                                <p class="mb-0 text-muted fst-italic">Nenhuma observação cadastrada para este cliente.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Status do Cliente</label>
                        <p class="mb-0">
                            {% set status = client.get('statusCliente', 'ativo')|lower %}
                            {% if status == 'ativo' %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle me-1"></i>Ativo
                                </span>
                            {% else %}
                                <span class="badge bg-secondary">
                                    <i class="fas fa-pause-circle me-1"></i>Inativo
                                </span>
                            {% endif %}
                        </p>
                    </div>
                    {% if client.ultimaAtualizacao %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Última Atualização</label>
                        <p class="mb-0"><i class="fas fa-clock me-1"></i>{{ client.ultimaAtualizacao | format_datetime }}</p>
                    </div>
                    {% endif %}
                    {% if client.criadoEm %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Data de Criação</label>
                        <p class="mb-0"><i class="fas fa-calendar-plus me-1"></i>{{ client.criadoEm | format_datetime }}</p>
                    </div>
                    {% endif %}
                    {% if client.responsavelAtualizacao %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Responsável pela Última Atualização</label>
                        <p class="mb-0"><i class="fas fa-user-edit me-1"></i>{{ client.responsavelAtualizacao }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Coluna lateral direita - 4 colunas -->
    <div class="col-lg-4">
        <!-- Painel de Acesso Rápido (Novo Layout) -->
        <div class="card mb-4">
            <div class="card-header bg-light border-0">
                <h5 class="mb-0 fw-bold">Acesso Rápido</h5>
            </div>
            <div class="card-body">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Cliente Ativo:</span>
                    {% set status = client.get('statusCliente', 'ativo')|lower %}
                    <span class="fw-bold text-{{ 'success' if status == 'ativo' else 'danger' }}">{{ 'SIM' if status == 'ativo' else 'NÃO' }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Cliente desde:</span>
                    <span class="fw-bold">
                        {% if client.dataInicioServicos or client.mesAnoInicio %}
                            <i class="bi bi-calendar-event me-1 text-primary"></i>
                            {{ (client.dataInicioServicos or client.mesAnoInicio)|format_mm_yyyy }}
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Perfil do Cliente:</span>
                    {% set perfil_val = client.perfil or client.perfilCliente %}
                    <span class="fw-bold text-info">{{ perfil_val or '-' }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Serviços:</span>
                    <span>
                        {% if client.bpoFinanceiro %}<span class="badge bg-info px-3">BPO</span>{% endif %}
                        {% if client.ct %}<span class="badge bg-success px-3">CT</span>{% endif %}
                        {% if client.fs %}<span class="badge bg-success px-3">FS</span>{% endif %}
                        {% if client.dp %}<span class="badge bg-success px-3">DP</span>{% endif %}
                        {% if not client.bpoFinanceiro and not client.ct and not client.fs and not client.dp %}<span class="badge bg-secondary px-3">Nenhum</span>{% endif %}
                    </span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Doméstica:</span>
                    <span>{% if client.domestica == 'SIM' or client.domestica == True %}<span class="badge bg-warning text-white px-3">SIM</span>{% else %}<span class="badge bg-warning text-white px-3">NÃO</span>{% endif %}</span>
                </div>
                <hr />
                <div class="mb-2 fw-bold text-muted">Códigos nos Sistemas:</div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Cód. Domínio:</span>
                    <span class="fw-bold text-dark">{{ client.codDominio or '-' }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Cód. Fortes CT:</span>
                    <span class="fw-bold text-dark">{{ client.codFortesCt or '-' }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Cód. Fortes FS:</span>
                    <span class="fw-bold text-dark">{{ client.codFortesFs or '-' }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Cód. Fortes PS:</span>
                    <span class="fw-bold text-dark">{{ client.codFortesPs or '-' }}</span>
                </div>
                <hr />
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Sistema Utilizado:</span>
                    <span class="fw-bold">{{ (client.sistemaUtilizado or '-')|upper }}</span>
                </div>
                <div class="mb-2 d-flex justify-content-between align-items-center">
                    <span class="text-muted">Gera Arquivo do Sped:</span>
                    <span class="fw-bold text-dark">
                        {{ 'SIM' if client.geraArquivoSped in ['SIM', True, 'true', 'True', 1] else 'NÃO' }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Ações Rápidas -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>
                    Ações Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex flex-column gap-2">
                    <!-- 1. Ver Reuniões -->
                    <a href="/client/{{ client.id }}/meetings" class="btn btn-outline-info w-100">
                        <i class="fas fa-calendar-alt me-2"></i>
                        Ver Reuniões
                    </a>
                    
                    <!-- 2. Registrar Reuniões -->
                    <a href="/client/{{ client.id }}/meeting" class="btn btn-info w-100">
                        <i class="fas fa-calendar-plus me-2"></i>
                        Registrar Reunião
                    </a>
                    
                    <!-- 3. Editar Cliente -->
                    {% if can_edit() %}
                    <a href="/client/{{ client.id }}/edit" class="btn btn-primary w-100">
                        <i class="fas fa-edit me-2"></i>
                        Editar Cliente
                    </a>
                    {% endif %}
                    
                    <!-- 4. Excluir Cliente -->
                    {% if can_delete() %}
                    <button type="button" class="btn btn-outline-danger w-100" data-bs-toggle="modal" data-bs-target="#deleteModal">
                        <i class="fas fa-trash me-2"></i>
                        Excluir Cliente
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
{% if can_delete() %}
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirmar Exclusão
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger d-flex align-items-center" role="alert">
                    <i class="fas fa-exclamation-triangle me-3"></i>
                    <div>
                        <strong>Atenção!</strong> Esta ação não pode ser desfeita.
                    </div>
                </div>
                <p>Tem certeza que deseja excluir o cliente <strong>{{ client.nomeEmpresa }}</strong>?</p>
                <p class="text-muted">Todos os dados relacionados a este cliente serão permanentemente removidos.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>
                    Cancelar
                </button>
                <form method="POST" action="/client/{{ client.id }}/delete" style="display: inline;">
                    {% if client._row_number %}
                    <input type="hidden" name="row_number" value="{{ client._row_number }}">
                    {% endif %}
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-2"></i>
                        Confirmar Exclusão
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-dot.active {
    background-color: #28a745;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
}

.status-dot.inactive {
    background-color: #6c757d;
    box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
}

.quick-info .info-item {
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
}

.quick-info .info-item:last-child {
    border-bottom: none;
}

.service-badges .badge {
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.credential-field .input-group {
    max-width: 100%;
}

.credential-input {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.toggle-password-btn {
    border-left: none;
}

.toggle-password-btn:hover {
    background-color: #e9ecef;
}

@media (max-width: 991px) {
    .col-lg-4 {
        margin-top: 2rem;
    }
}
</style>

<script>
function toggleCredentialVisibility(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        button.title = 'Ocultar senha';
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        button.title = 'Mostrar senha';
    }
}
</script>

{% endblock %}
