{% extends "base.html" %}

<!-- Macro para remover máscaras de CPF/CNPJ (manter apenas números) -->
{% macro remove_mask(text) -%}
{{ text|replace('.', '')|replace('-', '')|replace('/', '')|replace(' ', '')|replace('(', '')|replace(')', '') if text else '' }}
{%- endmacro %}

{% block title %}{{ client.nomeEmpresa }} - SIGEC{% endblock %}

{% block content %}
<!-- Header da página -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1>
                <i class="bi bi-eye" style="color: var(--control-primary);"></i>
                {{ client.nomeEmpresa }}
            </h1>
            <p class="mb-2">
                {% if client.nomeFantasiaReceita and client.nomeFantasiaReceita != client.nomeEmpresa %}
                    <strong>Nome Fantasia:</strong> {{ client.nomeFantasiaReceita }}
                {% else %}
                    SIGEC - Sistema de Gestão de Empresas Control - Visualização completa do cliente
                {% endif %}
            </p>
            <div class="d-flex gap-2 align-items-center">
                {% set status = client.get('statusCliente', 'ativo')|lower %}
                {% if status == 'ativo' %}
                    <span class="status-indicator">
                        <span class="status-dot active"></span>
                        <strong class="text-success">Cliente Ativo</strong>
                    </span>
                {% else %}
                    <span class="status-indicator">
                        <span class="status-dot inactive"></span>
                        <strong class="text-muted">Cliente Inativo</strong>
                    </span>
                {% endif %}
                {% if client.cnpj %}
                    <span class="text-muted">•</span>
                    <code class="text-muted">{{ client.cnpj }}</code>
                {% endif %}
                {% if client.cidade %}
                    <span class="text-muted">•</span>
                    <span class="text-muted">{{ client.cidade }}</span>
                {% endif %}
            </div>
        </div>
        <div class="col-md-4 text-end">
            <a href="/client/{{ client.id }}/edit" class="btn btn-primary me-2">
                <i class="bi bi-pencil"></i>
                Editar
            </a>
            <a href="/" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i>
                Voltar
            </a>
        </div>
    </div>
</div>

<div class="row">
    <!-- Coluna principal - 8 colunas -->
    <div class="col-lg-8">
        <!-- Bloco 1: Informações da Pessoa Física / Jurídica -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-building me-2"></i>
                    Bloco 1 - Informações da Pessoa Física / Jurídica
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Nome da Empresa</label>
                        <p class="mb-0"><strong>{{ client.nomeEmpresa or '-' }}</strong></p>
                    </div>
                    {% if client.razaoSocialReceita %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Razão Social (Receita)</label>
                        <p class="mb-0">{{ client.razaoSocialReceita }}</p>
                    </div>
                    {% endif %}
                    {% if client.nomeFantasiaReceita %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Nome Fantasia (Receita)</label>
                        <p class="mb-0">{{ client.nomeFantasiaReceita }}</p>
                    </div>
                    {% endif %}
                    {% if client.cpfCnpj or client.cnpj %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">CPF/CNPJ</label>
                        <p class="mb-0"><code>{{ remove_mask(client.cpfCnpj or client.cnpj) }}</code></p>
                    </div>
                    {% endif %}
                    {% if client.inscEst %}
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted">Inscrição Estadual</label>
                        <p class="mb-0">{{ client.inscEst }}</p>
                    </div>
                    {% endif %}
                    {% if client.inscMun %}
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted">Inscrição Municipal</label>
                        <p class="mb-0">{{ client.inscMun }}</p>
                    </div>
                    {% endif %}
                    {% if client.estado %}
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted">Estado</label>
                        <p class="mb-0"><span class="badge bg-primary">{{ client.estado }}</span></p>
                    </div>
                    {% endif %}
                    {% if client.cidade %}
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted">Cidade</label>
                        <p class="mb-0">{{ client.cidade }}</p>
                    </div>
                    {% endif %}
                    {% if client.regimeFederal or client.tributacao %}
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted">Regime Federal</label>
                        <p class="mb-0"><span class="badge bg-secondary">{{ client.regimeFederal or client.tributacao }}</span></p>
                    </div>
                    {% endif %}
                    {% if client.regimeEstadual %}
                    <div class="col-md-4 mb-3">
                        <label class="form-label text-muted">Regime Estadual</label>
                        <p class="mb-0"><span class="badge bg-secondary">{{ client.regimeEstadual }}</span></p>
                    </div>
                    {% endif %}
                    {% if client.segmento %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Segmento</label>
                        <p class="mb-0">{{ client.segmento }}</p>
                    </div>
                    {% endif %}
                    {% if client.atividade %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Atividade Principal</label>
                        <p class="mb-0">{{ client.atividade }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Bloco 3: Quadro Societário -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-users me-2"></i>
                    Bloco 3 - Quadro Societário
                </h5>
            </div>
            <div class="card-body">
                {% set socios_existentes = [] %}
                {% for i in range(1, 11) %}
                    {% set socio_nome = client.get('socio_' ~ i ~ '_nome') or client.get('socio' ~ i ~ '_nome') or client.get('socio' ~ i ~ 'Nome') or client.get('socio' ~ i) %}
                    {% if socio_nome %}
                        {% set _ = socios_existentes.append(socio_nome) %}
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6 class="text-primary">
                                    <i class="fas fa-user me-2"></i>
                                    Sócio {{ i }}
                                </h6>
                            </div>
                            <div class="col-md-6 mb-2">
                                <label class="form-label text-muted">Nome</label>
                                <p class="mb-0"><strong>{{ socio_nome }}</strong></p>
                            </div>
                            {% set socio_cpf = client.get('socio_' ~ i ~ '_cpf') or client.get('socio' ~ i ~ '_cpf') or client.get('socio' ~ i ~ 'Cpf') %}
                            {% if socio_cpf %}
                            <div class="col-md-6 mb-2">
                                <label class="form-label text-muted">CPF</label>
                                <p class="mb-0"><code>{{ socio_cpf }}</code></p>
                            </div>
                            {% endif %}
                            {% set socio_nasc = client.get('socio_' ~ i ~ '_data_nascimento') or client.get('socio_' ~ i ~ '_dataNascimento') or client.get('socio' ~ i ~ '_nascimento') or client.get('socio' ~ i ~ 'DataNascimento') %}
                            {% if socio_nasc %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Data Nascimento</label>
                                <p class="mb-0">{{ socio_nasc|format_date if socio_nasc else socio_nasc }}</p>
                            </div>
                            {% endif %}
                            {% set socio_cotas = client.get('socio_' ~ i ~ '_cotas') or client.get('socio' ~ i ~ '_quotas') or client.get('socio' ~ i ~ 'Cotas') %}
                            {% if socio_cotas %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Cotas</label>
                                <p class="mb-0"><strong>{{ socio_cotas }}</strong></p>
                            </div>
                            {% endif %}
                            {% set socio_admin = client.get('socio_' ~ i ~ '_administrador') or client.get('socio' ~ i ~ '_admin') or client.get('socio' ~ i ~ 'Admin') %}
                            {% if socio_admin %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Administrador</label>
                                <p class="mb-0"><span class="badge bg-success">{{ 'SIM' if socio_admin else 'NÃO' }}</span></p>
                            </div>
                            {% endif %}
                            {% set socio_part = client.get('socio_' ~ i ~ '_participacao') or client.get('socio' ~ i ~ '_cotas') or client.get('socio' ~ i ~ 'Cotas') %}
                            {% if socio_part %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">% Participação</label>
                                <p class="mb-0">{{ socio_part }}%</p>
                            </div>
                            {% endif %}
                            {% set socio_resp = client.get('socio_' ~ i ~ '_resp_legal') or client.get('socio' ~ i ~ '_respLegal') %}
                            {% if socio_resp %}
                            <div class="col-md-4 mb-2">
                                <label class="form-label text-muted">Responsável Legal</label>
                                <p class="mb-0"><span class="badge bg-info">{{ 'SIM' if socio_resp else 'NÃO' }}</span></p>
                            </div>
                            {% endif %}
                        </div>
                        {% if not loop.last %}<hr>{% endif %}
                    {% endif %}
                {% endfor %}
                {% if socios_existentes|length == 0 %}
                    <p class="text-muted text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Nenhum sócio cadastrado
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Bloco 4: Contatos -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-address-book me-2"></i>
                    Bloco 4 - Contatos
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Contato 1 -->
                    {% if client.contato_1_nome or client.contato_1_telefone or client.contato_1_email or client.contato_1_cargo %}
                    <div class="col-md-12 mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Contato 1</h6>
                        <div class="row">
                            {% if client.contato_1_nome %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Nome</label>
                                <p class="mb-0"><i class="bi bi-person me-1"></i>{{ client.contato_1_nome }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_1_cargo %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Cargo</label>
                                <p class="mb-0"><i class="bi bi-briefcase me-1"></i>{{ client.contato_1_cargo }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_1_telefone %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Telefone</label>
                                <p class="mb-0"><i class="bi bi-telephone me-1"></i>{{ client.contato_1_telefone }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_1_email %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">E-mail</label>
                                <p class="mb-0"><i class="bi bi-envelope me-1"></i>{{ client.contato_1_email }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Contato 2 -->
                    {% if client.contato_2_nome or client.contato_2_telefone or client.contato_2_email or client.contato_2_cargo %}
                    <div class="col-md-12 mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Contato 2</h6>
                        <div class="row">
                            {% if client.contato_2_nome %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Nome</label>
                                <p class="mb-0"><i class="bi bi-person me-1"></i>{{ client.contato_2_nome }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_2_cargo %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Cargo</label>
                                <p class="mb-0"><i class="bi bi-briefcase me-1"></i>{{ client.contato_2_cargo }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_2_telefone %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Telefone</label>
                                <p class="mb-0"><i class="bi bi-telephone me-1"></i>{{ client.contato_2_telefone }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_2_email %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">E-mail</label>
                                <p class="mb-0"><i class="bi bi-envelope me-1"></i>{{ client.contato_2_email }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Contato 3 -->
                    {% if client.contato_3_nome or client.contato_3_telefone or client.contato_3_email or client.contato_3_cargo %}
                    <div class="col-md-12 mb-4">
                        <h6 class="border-bottom pb-2 mb-3">Contato 3</h6>
                        <div class="row">
                            {% if client.contato_3_nome %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Nome</label>
                                <p class="mb-0"><i class="bi bi-person me-1"></i>{{ client.contato_3_nome }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_3_cargo %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Cargo</label>
                                <p class="mb-0"><i class="bi bi-briefcase me-1"></i>{{ client.contato_3_cargo }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_3_telefone %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">Telefone</label>
                                <p class="mb-0"><i class="bi bi-telephone me-1"></i>{{ client.contato_3_telefone }}</p>
                            </div>
                            {% endif %}
                            {% if client.contato_3_email %}
                            <div class="col-md-3 mb-2">
                                <label class="form-label text-muted">E-mail</label>
                                <p class="mb-0"><i class="bi bi-envelope me-1"></i>{{ client.contato_3_email }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Caso não tenha nenhum contato -->
                    {% if not (client.contato_1_nome or client.contato_1_telefone or client.contato_1_email or client.contato_1_cargo or client.contato_2_nome or client.contato_2_telefone or client.contato_2_email or client.contato_2_cargo or client.contato_3_nome or client.contato_3_telefone or client.contato_3_email or client.contato_3_cargo) %}
                    <div class="col-12">
                        <p class="text-muted text-center">
                            <i class="fas fa-info-circle me-2"></i>
                            Nenhum contato cadastrado
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Bloco 5: Senhas -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-key me-2"></i>
                    Bloco 5: Senhas
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Informações Sensíveis</strong> - Dados de acesso confidenciais
                </div>
                
                <!-- Linha 1: CPF/CNPJ SN, Código Acesso SN, Acesso EmpWeb, Senha EmpWeb -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">CPF/CNPJ SN</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ remove_mask(client.cpfCnpjSn) if client.cpfCnpjSn else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Código Acesso SN</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.codigoAcessoSn if client.codigoAcessoSn else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso EmpWeb</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoEmpWeb if client.acessoEmpWeb else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha EmpWeb</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaEmpWeb if client.senhaEmpWeb else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 2: Acesso ISS, Acesso SEFIN, Acesso SEUMA, Acesso SEMACE -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso ISS</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoIss if client.acessoIss else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso SEFIN</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoSefin if client.acessoSefin else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso SEUMA</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoSeuma if client.acessoSeuma else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso SEMACE</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoSemace if client.acessoSemace else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 3: Acesso IBAMA, Acesso FAP/INSS, Acesso CRF, Senha SEMACE -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso IBAMA</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoIbama if client.acessoIbama else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso FAP/INSS</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoFapInss if client.acessoFapInss else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Acesso CRF</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.acessoCrf if client.acessoCrf else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">Senha SEMACE</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.senhaSemace if client.senhaSemace else '-' }}</small></p>
                    </div>
                </div>

                <!-- Linha 4: ANVISA Gestor, ANVISA Empresa -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">ANVISA Gestor</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.anvisaGestor if client.anvisaGestor else '-' }}</small></p>
                    </div>
                    <div class="col-md-3 mb-2">
                        <label class="form-label text-muted small">ANVISA Empresa</label>
                        <p class="mb-0 border rounded p-2 bg-light"><small>{{ client.anvisaEmpresa if client.anvisaEmpresa else '-' }}</small></p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Bloco 6: Procurações -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="fas fa-file-contract me-2"></i>
                    Bloco 6 - Procurações
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% set procuracoes = [
                        ('Proc. Receita', client.procReceita, client.dataProcReceita),
                        ('Proc. DTe', client.procDte, client.dataProcDte),
                        ('Proc. Caixa', client.procCaixa, client.dataProcCaixa),
                        ('Proc. Emp. Web', client.procEmpWeb, client.dataProcEmpWeb),
                        ('Proc. DET', client.procDet, client.dataProcDet)
                    ] %}
                    
                    {% for nome, ativa, data in procuracoes %}
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">{{ nome }}</label>
                            <p class="mb-0">
                                {% if ativa %}
                                    <span class="badge bg-success me-2">
                                        <i class="fas fa-check me-1"></i>ATIVA
                                    </span>
                                    {% if data %}
                                        <small class="text-muted">{{ data | format_date }}</small>
                                    {% endif %}
                                {% else %}
                                    <span class="badge bg-secondary me-2">
                                        <i class="fas fa-minus me-1"></i>SEM PROCURAÇÃO
                                    </span>
                                {% endif %}
                            </p>
                        </div>
                    {% endfor %}
                </div>
                {% if client.outrasProc %}
                    <div class="row mt-3">
                        <div class="col-12">
                            <label class="form-label text-muted">Outras Procurações</label>
                            <p class="mb-0">{{ client.outrasProc }}</p>
                        </div>
                    </div>
                {% endif %}
                {% if client.obsProcuracoes %}
                    <div class="row mt-3">
                        <div class="col-12">
                            <label class="form-label text-muted">Observações sobre Procurações</label>
                            <p class="mb-0">{{ client.obsProcuracoes }}</p>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Bloco 7: Observações e Dados Adicionais -->
        <div class="card mb-4">
            <div class="card-header bg-light text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-sticky-note me-2"></i>
                    Bloco 7 - Observações e Dados Adicionais
                </h5>
            </div>
            <div class="card-body">
                {% if client.observacoes %}
                <div class="row mb-4">
                    <div class="col-12">
                        <label class="form-label text-muted">Observações</label>
                        <div class="bg-light p-3 rounded">
                            <p class="mb-0" style="white-space: pre-wrap;">{{ client.observacoes }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Status do Cliente</label>
                        <p class="mb-0">
                            {% set status = client.get('statusCliente', 'ativo')|lower %}
                            {% if status == 'ativo' %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle me-1"></i>Ativo
                                </span>
                            {% else %}
                                <span class="badge bg-secondary">
                                    <i class="fas fa-pause-circle me-1"></i>Inativo
                                </span>
                            {% endif %}
                        </p>
                    </div>
                    {% if client.ultimaAtualizacao %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Última Atualização</label>
                        <p class="mb-0"><i class="fas fa-clock me-1"></i>{{ client.ultimaAtualizacao | format_datetime }}</p>
                    </div>
                    {% endif %}
                    {% if client.criadoEm %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Data de Criação</label>
                        <p class="mb-0"><i class="fas fa-calendar-plus me-1"></i>{{ client.criadoEm | format_datetime }}</p>
                    </div>
                    {% endif %}
                    {% if client.responsavelAtualizacao %}
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Responsável pela Última Atualização</label>
                        <p class="mb-0"><i class="fas fa-user-edit me-1"></i>{{ client.responsavelAtualizacao }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Coluna lateral direita - 4 colunas -->
    <div class="col-lg-4">
        <!-- Painel de Acesso Rápido -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Acesso Rápido
                </h5>
            </div>
            <div class="card-body">
                <div class="quick-info">
                    <div class="info-item d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Cliente Ativo:</span>
                        {% set status = client.get('statusCliente', 'ativo')|lower %}
                        <strong class="text-{{ 'success' if status == 'ativo' else 'danger' }}">
                            {{ 'SIM' if status == 'ativo' else 'NÃO' }}
                        </strong>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Cliente desde:</span>
                        <strong>
                            {% if client.dataInicioServicos or client.mesAnoInicio %}
                                {{ client.dataInicioServicos or client.mesAnoInicio }}
                            {% else %}
                                -
                            {% endif %}
                        </strong>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Perfil do Cliente:</span>
                        <strong class="text-info">
                            {% if client.perfil or client.perfilCliente %}
                                {{ client.perfil or client.perfilCliente }}
                            {% else %}
                                -
                            {% endif %}
                        </strong>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Serviços:</span>
                        <div class="d-flex gap-1">
                            {% if client.ct %}
                                <span class="badge bg-success">CT</span>
                            {% else %}
                                <span class="badge bg-secondary">CT</span>
                            {% endif %}
                            {% if client.fs %}
                                <span class="badge bg-success">FS</span>
                            {% else %}
                                <span class="badge bg-secondary">FS</span>
                            {% endif %}
                            {% if client.dp %}
                                <span class="badge bg-success">DP</span>
                            {% else %}
                                <span class="badge bg-secondary">DP</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Doméstica:</span>
                        <strong>
                            {% if client.domestica == 'SIM' %}
                                <span class="badge bg-info">Sim</span>
                            {% else %}
                                <span class="badge bg-secondary">Não</span>
                            {% endif %}
                        </strong>
                    </div>
                    
                    <hr class="my-3">
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Códigos nos Sistemas:</span>
                        <strong class="text-primary">
                            {% if client.sistemaPrincipal or client.sistemaUtilizado %}
                                {{ client.sistemaPrincipal or client.sistemaUtilizado }}
                            {% else %}
                                -
                            {% endif %}
                        </strong>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Cód. Domínio:</span>
                        <code>{{ client.codDominio or '-' }}</code>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Cód. Fortes CT:</span>
                        <code>{{ client.codFortesCt or '-' }}</code>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Cód. Fortes FS:</span>
                        <code>{{ client.codFortesFs or '-' }}</code>
                    </div>
                    
                    <div class="info-item d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Cód. Fortes PS:</span>
                        <code>{{ client.codFortesPs or '-' }}</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ações Rápidas -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>
                    Ações Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <!-- 1. Ver Reuniões -->
                    <a href="/client/{{ client.id }}/meetings" class="btn btn-outline-info">
                        <i class="fas fa-calendar-alt me-2"></i>
                        Ver Reuniões
                    </a>
                    
                    <!-- 2. Registrar Reuniões -->
                    <a href="/client/{{ client.id }}/meeting" class="btn btn-info">
                        <i class="fas fa-calendar-plus me-2"></i>
                        Registrar Reunião
                    </a>
                    
                    <!-- 3. Editar Cliente -->
                    <a href="/client/{{ client.id }}/edit" class="btn btn-primary">
                        <i class="fas fa-edit me-2"></i>
                        Editar Cliente
                    </a>
                    
                    <!-- 4. Excluir Cliente -->
                    {% if session.user_perfil and session.user_perfil.lower() == 'administrador' %}
                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="fas fa-trash me-2"></i>
                            Excluir Cliente
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
{% if session.user_perfil and session.user_perfil.lower() == 'administrador' %}
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirmar Exclusão
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger d-flex align-items-center" role="alert">
                    <i class="fas fa-exclamation-triangle me-3"></i>
                    <div>
                        <strong>Atenção!</strong> Esta ação não pode ser desfeita.
                    </div>
                </div>
                <p>Tem certeza que deseja excluir o cliente <strong>{{ client.nomeEmpresa }}</strong>?</p>
                <p class="text-muted">Todos os dados relacionados a este cliente serão permanentemente removidos.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>
                    Cancelar
                </button>
                <form method="POST" action="/client/{{ client.id }}/delete" style="display: inline;">
                    {% if client._row_number %}
                    <input type="hidden" name="row_number" value="{{ client._row_number }}">
                    {% endif %}
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-2"></i>
                        Confirmar Exclusão
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
}

.status-dot.active {
    background-color: #28a745;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
}

.status-dot.inactive {
    background-color: #6c757d;
    box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
}

.quick-info .info-item {
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
}

.quick-info .info-item:last-child {
    border-bottom: none;
}

.service-badges .badge {
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.credential-field .input-group {
    max-width: 100%;
}

.credential-input {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.toggle-password-btn {
    border-left: none;
}

.toggle-password-btn:hover {
    background-color: #e9ecef;
}

@media (max-width: 991px) {
    .col-lg-4 {
        margin-top: 2rem;
    }
}
</style>

<script>
function toggleCredentialVisibility(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        button.title = 'Ocultar senha';
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        button.title = 'Mostrar senha';
    }
}
</script>

{% endblock %}
