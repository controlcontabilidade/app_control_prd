{% extends "base.html" %}

{% block title %}SiGEC ‚Äì Sistema de Gest√£o de Empresas Control{% endblock %}

{% block content %}
<!-- Alerta de Status do Sistema -->
<div id="system-status-alert" class="d-none">
    <div class="alert alert-warning alert-dismissible fade show mb-4" role="alert">
        <div class="d-flex align-items-center">
            <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
            <div>
                <h6 class="alert-heading mb-1">üîß Sistema em Modo de Manuten√ß√£o</h6>
                <p class="mb-0">
                    O sistema est√° temporariamente usando dados locais devido a problemas de conectividade.
                    <a href="/api/auth-status" target="_blank" class="alert-link">Verificar Status</a>
                </p>
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
</div>

<!-- Dashboard -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-12">
            <h1>
                <i class="bi bi-graph-up text-primary"></i>
                SIGEC - Sistema de Gest√£o de Empresas da Control
                <span id="fallback-indicator" class="d-none">
                    <span class="badge bg-warning text-dark ms-2">
                        <i class="bi bi-exclamation-triangle"></i> MODO OFFLINE
                    </span>
                </span>
            </h1>
        </div>
    </div>
    
    <!-- Indicadores -->
    <div class="row mt-4 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 pb-0">
                    <h6 class="mb-0 text-muted fw-normal">
                        <i class="bi bi-speedometer2 me-2"></i>
                        INDICADORES DO SISTEMA
                    </h6>
                </div>
                <div class="card-body pt-3">
                    <!-- Indicadores Principais -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-3 col-md-6">
                            <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6;">
                                <div class="flex-shrink-0 me-2">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 35px; height: 35px; background: #3b82f6;">
                                        <i class="bi bi-people text-white fs-6"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-0 fw-bold text-primary">{{ stats.total_clientes or 0 }}</h5>
                                    <small class="text-muted">TOTAL DE CLIENTES</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e;">
                                <div class="flex-shrink-0 me-2">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 35px; height: 35px; background: #22c55e;">
                                        <i class="bi bi-check-circle text-white fs-6"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-0 fw-bold text-success">{{ stats.clientes_ativos or 0 }}</h5>
                                    <small class="text-muted">CLIENTES ATIVOS</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b;">
                                <div class="flex-shrink-0 me-2">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 35px; height: 35px; background: #f59e0b;">
                                        <i class="bi bi-building text-white fs-6"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-0 fw-bold" style="color: #f59e0b;">{{ stats.empresas or 0 }}</h5>
                                    <small class="text-muted">EMPRESAS</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(168, 85, 247, 0.1); border-left: 4px solid #a855f7;">
                                <div class="flex-shrink-0 me-2">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 35px; height: 35px; background: #a855f7;">
                                        <i class="bi bi-house text-white fs-6"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-0 fw-bold text-purple">{{ stats.domesticas or 0 }}</h5>
                                    <small class="text-muted">DOM√âSTICAS</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Servi√ßos e Regime -->
                    <div class="row g-3 mt-3">
                        <!-- SERVI√áOS PRESTADOS -->
                        <div class="col-lg-6">
                            <h6 class="text-muted mb-3 fw-normal">
                                <i class="bi bi-briefcase me-2"></i>
                                SERVI√áOS PRESTADOS
                            </h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #3b82f6;">
                                                <i class="bi bi-calculator text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold text-primary">{{ stats.ct or 0 }}</h6>
                                            <small class="text-muted">CONT√ÅBIL</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #22c55e;">
                                                <i class="bi bi-file-text text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold text-success">{{ stats.fs or 0 }}</h6>
                                            <small class="text-muted">FISCAL</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 mt-2">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #f59e0b;">
                                                <i class="bi bi-people text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold" style="color: #f59e0b;">{{ stats.dp or 0 }}</h6>
                                            <small class="text-muted">PESSOAL</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 mt-2">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(168, 85, 247, 0.1); border-left: 4px solid #a855f7;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #a855f7;">
                                                <i class="bi bi-graph-up text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold text-purple">{{ stats.bpo or 0 }}</h6>
                                            <small class="text-muted">BPO</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- REGIME TRIBUT√ÅRIO -->
                        <div class="col-lg-6">
                            <h6 class="text-muted mb-3 fw-normal">
                                <i class="bi bi-percent me-2"></i>
                                REGIME TRIBUT√ÅRIO
                            </h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #3b82f6;">
                                                <i class="bi bi-person-badge text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold text-primary">{{ stats.mei or 0 }}</h6>
                                            <small class="text-muted">MEI</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #22c55e;">
                                                <i class="bi bi-check-circle text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold text-success">{{ stats.simples_nacional or 0 }}</h6>
                                            <small class="text-muted">SIMPLES NACIONAL</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 mt-2">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #f59e0b;">
                                                <i class="bi bi-currency-dollar text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold" style="color: #f59e0b;">{{ stats.lucro_presumido or 0 }}</h6>
                                            <small class="text-muted">LUCRO PRESUMIDO</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 mt-2">
                                    <div class="d-flex align-items-center p-2 rounded-3" style="background: rgba(168, 85, 247, 0.1); border-left: 4px solid #a855f7;">
                                        <div class="flex-shrink-0 me-2">
                                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; background: #a855f7;">
                                                <i class="bi bi-graph-up-arrow text-white" style="font-size: 0.8rem;"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0 fw-bold text-purple">{{ stats.lucro_real or 0 }}</h6>
                                            <small class="text-muted">LUCRO REAL</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ Dashboard carregado');
    checkSystemStatus();
});

async function checkSystemStatus() {
    try {
        const response = await fetch('/api/auth-status');
        if (response.ok) {
            const data = await response.json();
            if (data.storage_service && data.storage_service.is_fallback) {
                const alert = document.getElementById('system-status-alert');
                const indicator = document.getElementById('fallback-indicator');
                if (alert) alert.classList.remove('d-none');
                if (indicator) indicator.classList.remove('d-none');
            }
        }
    } catch (error) {
        console.error('‚ùå Erro ao verificar status:', error);
    }
}

setInterval(checkSystemStatus, 5 * 60 * 1000);
</script>

{% endblock %}
