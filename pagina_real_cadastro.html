<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SIGEC - Sistema de Gestão de Empresas Control. Contabilidade Consultiva Especializada para o seu negócio.">
    <meta name="keywords" content="sigec, sistema gestão, contabilidade, fiscal, departamento pessoal, consultoria, fortaleza, ceará">
    <meta name="author" content="Control Contabilidade LTDA">
    <title>Novo Cliente</title>
    
    <!-- Favicon personalizado SIGEC -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='15' fill='%23f97316'/><text x='50' y='65' font-family='Arial,sans-serif' font-size='60' font-weight='900' text-anchor='middle' fill='white'>S</text></svg>">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Control Contabilidade Brand Colors */
            --control-primary: #1e3a8a;       /* Azul escuro profissional */
            --control-primary-light: #3b82f6;  /* Azul médio */
            --control-primary-dark: #1e40af;   /* Azul muito escuro */
            --control-secondary: #f97316;      /* Laranja Control */
            --control-secondary-light: #fb923c; /* Laranja claro */
            --control-secondary-dark: #ea580c;  /* Laranja escuro */
            
            /* Sistema de cores atualizado */
            --primary-color: var(--control-primary);
            --primary-hover: var(--control-primary-dark);
            --primary-light: #dbeafe;
            --secondary-color: var(--control-secondary);
            --secondary-light: #fed7aa;
            --success-color: #059669;
            --success-light: #d1fae5;
            --warning-color: var(--control-secondary);
            --warning-light: var(--secondary-light);
            --danger-color: #dc2626;
            --danger-light: #fecaca;
            --background: #f8fafc;
            --background-alt: #f1f5f9;
            --surface: #ffffff;
            --surface-hover: #f8fafc;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --radius: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
            min-height: 100vh;
        }

        /* Header/Navbar com identidade Control */
        .navbar {
            background: linear-gradient(135deg, var(--control-primary) 0%, var(--control-primary-dark) 100%);
            box-shadow: var(--shadow-lg);
            border: none;
            padding: 1.2rem 0;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1000;
            overflow: visible !important;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: white !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Logo Control personalizado */
        .control-logo {
            background: linear-gradient(135deg, var(--control-secondary) 0%, var(--control-secondary-dark) 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 18px;
            box-shadow: var(--shadow);
        }

        /* Logo Control como imagem */
        .control-logo-img {
            height: 45px;
            width: auto;
            margin-right: 12px;
            filter: brightness(1.1);
            transition: all 0.3s ease;
        }

        .control-logo-img:hover {
            filter: brightness(1.2) drop-shadow(0 2px 8px rgba(0,0,0,0.2));
        }

        /* Logo Control CSS - Nova versão fiel ao design original */
        .control-logo-brand {
            display: inline-flex;
            align-items: center;
            font-family: 'Arial Black', Arial, sans-serif;
            height: 45px;
            margin-right: 15px;
            transition: all 0.3s ease;
        }

        .control-logo-brand:hover {
            transform: translateY(-1px);
        }

        .control-circle-brand {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            box-shadow: 0 3px 10px rgba(30, 60, 114, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .check-mark-brand {
            color: #ff8c42;
            font-size: 18px;
            font-weight: bold;
            line-height: 1;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .text-part-brand {
            display: flex;
            flex-direction: column;
            line-height: 1;
        }

        .control-text-brand {
            font-size: 16px;
            font-weight: 900;
            color: white;
            margin: 0;
            letter-spacing: -0.3px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .contabilidade-text-brand {
            font-size: 7px;
            font-weight: 600;
            color: rgba(255, 140, 66, 0.9);
            letter-spacing: 1px;
            margin: 0;
            margin-top: -1px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Responsividade da logo */
        @media (max-width: 768px) {
            .control-logo-brand {
                height: 40px;
                margin-right: 10px;
            }
            
            .control-circle-brand {
                width: 35px;
                height: 35px;
                margin-right: 6px;
            }
            
            .check-mark-brand {
                font-size: 16px;
            }
            
            .control-text-brand {
                font-size: 14px;
            }
            
            .contabilidade-text-brand {
                font-size: 6px;
            }
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .brand-text .main {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .brand-text .sub {
            font-size: 0.75rem;
            font-weight: 400;
            opacity: 0.9;
            margin-top: -2px;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.85) !important;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
        }
        
        .nav-link:hover {
            color: white !important;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        /* Estilos do usuário */
        .user-avatar {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: white;
        }
        
        .user-info {
            text-align: left;
        }
        
        .user-name {
            color: white;
            font-weight: 500;
            display: block;
            line-height: 1.2;
        }
        
        .user-role {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.2;
        }
        
        /* Estilos específicos para corrigir dropdown do administrador */
        .dropdown .dropdown-toggle {
            border: none !important;
            background: transparent !important;
            color: rgba(255, 255, 255, 0.85) !important;
            padding: 0.5rem 1rem !important;
        }
        
        .dropdown .dropdown-toggle:hover {
            color: white !important;
            background: rgba(255, 255, 255, 0.1) !important;
        }
        
        .dropdown .dropdown-toggle:focus {
            box-shadow: none !important;
            outline: none !important;
        }
        
        /* Dropdown específico do usuário/administrador */
        .dropdown ul.dropdown-menu {
            background: white !important;
            border: 1px solid rgba(0,0,0,0.1) !important;
            border-radius: var(--radius) !important;
            padding: 0.5rem 0 !important;
            margin: 0 !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
            min-width: 220px !important;
            z-index: 999999 !important;
            position: absolute !important;
            top: calc(100% + 5px) !important;
            right: 0 !important;
            left: auto !important;
            transform: none !important;
        }
        
        .dropdown ul.dropdown-menu li {
            list-style: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .dropdown ul.dropdown-menu li a.dropdown-item {
            display: flex !important;
            align-items: center !important;
            padding: 0.75rem 1.25rem !important;
            color: var(--text-primary) !important;
            text-decoration: none !important;
            font-size: 0.9rem !important;
            transition: all 0.2s ease !important;
            border: none !important;
            background: transparent !important;
        }
        
        .dropdown ul.dropdown-menu li a.dropdown-item:hover {
            background: var(--control-primary) !important;
            color: white !important;
        }
        
        .dropdown ul.dropdown-menu li a.dropdown-item i {
            margin-right: 0.75rem !important;
            font-size: 1rem !important;
        }
        
        .dropdown ul.dropdown-menu li hr.dropdown-divider {
            margin: 0.5rem 0 !important;
            border-color: rgba(0,0,0,0.1) !important;
        }
        
        /* Dropdown com prioridade máxima */
        .dropdown {
            z-index: 999999 !important;
            position: relative !important;
        }
        
        .dropdown-menu {
            border: none !important;
            box-shadow: var(--shadow-xl) !important;
            border-radius: var(--radius) !important;
            margin-top: 0.5rem !important;
            z-index: 999999 !important;
            position: absolute !important;
            top: 100% !important;
            right: 0 !important;
            left: auto !important;
            min-width: 200px !important;
            max-height: none !important;
            overflow: visible !important;
            transform: none !important;
            background: white !important;
            display: none !important;
        }
        
        .dropdown-menu.show {
            display: block !important;
            z-index: 999999 !important;
        }
        
        /* Garante que dropdown do usuário apareça sempre na frente */
        #userDropdown {
            z-index: 999999 !important;
            position: relative !important;
        }
        
        .dropdown-menu-end {
            z-index: 999999 !important;
            right: 0 !important;
            left: auto !important;
        }
        
        /* Força a navbar a ter overflow visível */
        .navbar {
            overflow: visible !important;
        }
        
        .navbar-nav {
            overflow: visible !important;
        }
        
        .nav-item {
            overflow: visible !important;
        }
        
        .dropdown-item {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            color: var(--text-primary) !important;
            text-decoration: none !important;
            display: flex !important;
            align-items: center !important;
            white-space: nowrap !important;
        }
        
        .dropdown-item:hover {
            background: var(--control-primary) !important;
            color: white !important;
        }
        
        .dropdown-item i {
            margin-right: 0.5rem !important;
        }
        
        /* Garante que o container principal não corte o dropdown */
        body {
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .main-container {
            overflow: visible !important;
        }
        
        .container-responsive {
            overflow: visible !important;
        }

        /* Container principal - largura máxima do monitor */
        .main-container {
            width: 100%;
            max-width: 100vw;
            margin: 0;
            padding: 1rem 0.5rem;
            min-height: calc(100vh - 140px);
        }

        /* Container responsivo para ocupar toda a largura disponível */
        .container-responsive {
            width: 100%;
            max-width: 100%;
            padding: 0 0.5rem;
        }

        /* Navbar também em largura total */
        .navbar .container-fluid {
            max-width: 100%;
            padding: 0 1rem;
        }

        /* Footer em largura total */
        footer .container-fluid {
            max-width: 100%;
            padding: 0 1rem;
        }

        /* Para telas muito pequenas, mantém um padding mínimo */
        @media (max-width: 576px) {
            .container-responsive {
                padding: 0 0.25rem;
            }
            
            .main-container {
                padding: 0.5rem 0.25rem;
            }
        }

        /* Para telas grandes, remove qualquer limitação de largura */
        @media (min-width: 1200px) {
            .main-container {
                padding: 1rem 0.75rem;
            }
            
            .container-responsive {
                padding: 0 0.75rem;
            }
        }

        /* Para telas ultra-largas, maximiza o aproveitamento */
        @media (min-width: 1600px) {
            .main-container {
                padding: 1rem 1rem;
            }
            
            .container-responsive {
                padding: 0 1rem;
            }
        }

        /* Cards */
        .card {
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            background: var(--surface);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            background: linear-gradient(135deg, var(--surface) 0%, var(--background-alt) 100%);
            border-bottom: 1px solid var(--border);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0 !important;
            padding: 1.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Página header */
        .page-header {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .page-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 1rem;
            margin: 0;
        }

        .card-header h5 {
            color: var(--text-primary);
            font-weight: 600;
            margin: 0;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Botões com identidade Control */
        .btn {
            border-radius: var(--radius);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--control-primary) 0%, var(--control-primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--control-primary-dark) 0%, #1e40af 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #047857 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--control-secondary) 0%, var(--control-secondary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--control-secondary-dark) 0%, #c2410c 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--control-secondary) 0%, var(--control-secondary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, var(--control-secondary-dark) 0%, #c2410c 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #b91c1c 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Form elements modernos */
        .form-control, .form-select {
            border: 1.5px solid var(--border);
            border-radius: var(--radius);
            padding: 0.875rem 1rem;
            transition: all 0.3s ease;
            background: var(--surface);
            font-size: 0.875rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
            background: var(--surface);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-text {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        /* Tables modernas */
        .table {
            background: var(--surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .table thead th {
            background: linear-gradient(135deg, var(--background-alt) 0%, var(--border-light) 100%);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            color: var(--text-primary);
            padding: 1.25rem 1rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .table tbody td {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
            font-size: 0.875rem;
        }

        .table tbody tr {
            transition: all 0.2s ease;
        }

        .table tbody tr:hover {
            background: var(--surface-hover);
            transform: translateX(2px);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Alerts modernos */
        .alert {
            border-radius: var(--radius);
            border: none;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
            z-index: 1040;
            position: relative;
        }

        .alert-success {
            background: linear-gradient(135deg, var(--success-light) 0%, #dcfce7 100%);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .alert-danger {
            background: linear-gradient(135deg, var(--danger-light) 0%, #fee2e2 100%);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        .alert-warning {
            background: linear-gradient(135deg, var(--warning-light) 0%, #fef3c7 100%);
            color: var(--warning-color);
            border-left: 4px solid var(--warning-color);
        }

        .alert-info {
            background: linear-gradient(135deg, var(--primary-light) 0%, #dbeafe 100%);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }

        /* Badges com identidade Control */
        .badge {
            border-radius: var(--radius);
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.025em;
            text-transform: uppercase;
        }

        .badge.bg-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #047857 100%) !important;
            color: white;
        }

        .badge.bg-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #b91c1c 100%) !important;
            color: white;
        }

        .badge.bg-warning {
            background: linear-gradient(135deg, var(--control-secondary) 0%, var(--control-secondary-dark) 100%) !important;
            color: white;
        }

        .badge.bg-light {
            background: var(--background-alt) !important;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .badge.bg-primary {
            background: linear-gradient(135deg, var(--control-primary) 0%, var(--control-primary-dark) 100%) !important;
            color: white;
        }

        .badge.bg-secondary {
            background: linear-gradient(135deg, var(--control-secondary) 0%, var(--control-secondary-dark) 100%) !important;
            color: white;
        }

        /* Loading e estados */
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
        }

        .spinner {
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.active {
            background: var(--success-color);
        }

        .status-dot.inactive {
            background: var(--text-muted);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Container - Layout tela cheia responsivo */
        .main-container {
            width: 100%;
            max-width: 100%;
            margin: 0;
            padding: 1rem 0.75rem;
            min-height: calc(100vh - 140px);
        }

        /* Container responsivo para diferentes tamanhos */
        .container-responsive {
            width: 100%;
            max-width: 100%;
            padding: 0 0.75rem;
        }

        /* Media Queries para responsividade aprimorada */
        @media (max-width: 768px) {
            .main-container {
                padding: 0.5rem 0.25rem;
            }
            
            .container-responsive {
                padding: 0 0.25rem;
            }

            .navbar-brand .brand-text .main {
                font-size: 1.2rem;
            }

            .navbar-brand .brand-text .sub {
                font-size: 0.6rem;
            }

            .page-header {
                padding: 1.5rem;
            }

            .page-header h1 {
                font-size: 1.5rem;
            }

            .card {
                margin-bottom: 1rem;
            }

            .table-responsive {
                font-size: 0.875rem;
            }
        }

        @media (max-width: 576px) {
            .container-responsive {
                padding: 0 0.25rem;
            }

            .page-header {
                padding: 1rem;
            }

            .navbar-brand .brand-text .sub {
                display: none;
            }

            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }

        /* Page header */
        .page-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .page-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem 0.5rem;
            }
            
            .page-header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <div class="control-logo-brand">
                    <div class="control-circle-brand">
                        <span class="check-mark-brand">✓</span>
                    </div>
                    <div class="text-part-brand">
                        <div class="control-text-brand">control</div>
                        <div class="contabilidade-text-brand">CONTABILIDADE</div>
                    </div>
                </div>
                <div class="brand-text">
                    <span class="main">SIGEC</span>
                    <span class="sub">Sistema de Gestão de Empresas Control</span>
                </div>
            </a>
            
            <div class="navbar-nav ms-auto d-flex flex-row gap-3 align-items-center">
                <a class="nav-link" href="/">
                    <i class="bi bi-house me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="/client/new">
                    <i class="bi bi-plus-circle me-1"></i>Novo Cliente
                </a>
                <a class="nav-link" href="/meetings">
                    <i class="bi bi-file-earmark-text me-1"></i>Atas de Reunião
                </a>
                
                <!-- Dropdown do usuário -->
                <div class="dropdown">
                    <button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" type="button" id="userDropdown" data-bs-toggle="dropdown">
                        <div class="me-2 d-flex align-items-center">
                            <div class="user-avatar me-2">
                                A
                            </div>
                            <span class="user-info d-none d-lg-block">
                                <small class="user-name">Administrador</small>
                                <small class="user-role text-muted d-block">Administrador</small>
                            </span>
                        </div>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        
                        <li><a class="dropdown-item" href="/users">
                            <i class="bi bi-people me-2"></i>Gerenciar Usuários
                        </a></li>
                        <li><a class="dropdown-item" href="/import">
                            <i class="bi bi-upload me-2"></i>Importar Clientes
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        
                        <li><a class="dropdown-item" href="/system-selection">
                            <i class="bi bi-grid-3x3-gap me-2"></i>Trocar Sistema
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/logout">
                            <i class="bi bi-box-arrow-right me-2"></i>Sair
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo principal da página -->
    <div class="main-container">
        <div class="container-responsive">
            
                
                    
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            Bem-vindo(a), Administrador!
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    
                
            

            
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12">
            
            <!-- Formulário Principal -->
            
            <!-- Formulário em modo edição/criação -->
            <form method="POST" action="/client" class="needs-validation" novalidate>
            
                <!-- Campo hidden para ID do cliente -->
                
                <!-- Bloco 1: Informações da Pessoa Física / Jurídica -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-person-vcard me-2"></i>
                            Informações da Pessoa Física / Jurídica
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Primeira linha: Nome da Empresa e Razão Social -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="nomeEmpresa" class="form-label">
                                    <i class="bi bi-building me-1"></i>Nome da Empresa
                                    <span class="text-danger required-field">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="nomeEmpresa" name="nomeEmpresa" 
                                       value="" required
                                       >
                                <div class="invalid-feedback">
                                    Por favor, informe o nome da empresa.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="razaoSocialReceita" class="form-label">
                                    <i class="bi bi-file-text me-1"></i>Razão Social (Receita)
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="razaoSocialReceita" name="razaoSocialReceita"
                                       value="">
                                <div class="invalid-feedback">
                                    Por favor, informe a razão social.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Segunda linha: Nome Fantasia e CPF/CNPJ -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="nomeFantasiaReceita" class="form-label">
                                    <i class="bi bi-shop me-1"></i>Nome Fantasia (Receita)
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="nomeFantasiaReceita" name="nomeFantasiaReceita"
                                       value="">
                                <div class="invalid-feedback">
                                    Por favor, informe o nome fantasia.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cpfCnpj" class="form-label">
                                    <i class="bi bi-card-text me-1"></i>CPF/CNPJ
                                    <span class="text-danger required-field">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="cpfCnpj" name="cpfCnpj"
                                       value="" 
                                       placeholder="" required>
                                <div class="invalid-feedback">
                                    Por favor, informe o CPF ou CNPJ.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Terceira linha: Estado, Cidade, Inscrição Estadual, Inscrição Municipal -->
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="estado" class="form-label">
                                    <i class="bi bi-map me-1"></i>Estado
                                    <span class="text-danger required-field">*</span>
                                </label>
                                <select class="form-select" id="estado" name="estado" required>
                                    <option value="">Selecione o estado</option>
                                    <option value="AC" >ACRE</option>
                                    <option value="AL" >ALAGOAS</option>
                                    <option value="AP" >AMAPÁ</option>
                                    <option value="AM" >AMAZONAS</option>
                                    <option value="BA" >BAHIA</option>
                                    <option value="CE" >CEARÁ</option>
                                    <option value="DF" >DISTRITO FEDERAL</option>
                                    <option value="ES" >ESPÍRITO SANTO</option>
                                    <option value="GO" >GOIÁS</option>
                                    <option value="MA" >MARANHÃO</option>
                                    <option value="MT" >MATO GROSSO</option>
                                    <option value="MS" >MATO GROSSO DO SUL</option>
                                    <option value="MG" >MINAS GERAIS</option>
                                    <option value="PA" >PARÁ</option>
                                    <option value="PB" >PARAÍBA</option>
                                    <option value="PR" >PARANÁ</option>
                                    <option value="PE" >PERNAMBUCO</option>
                                    <option value="PI" >PIAUÍ</option>
                                    <option value="RJ" >RIO DE JANEIRO</option>
                                    <option value="RN" >RIO GRANDE DO NORTE</option>
                                    <option value="RS" >RIO GRANDE DO SUL</option>
                                    <option value="RO" >RONDÔNIA</option>
                                    <option value="RR" >RORAIMA</option>
                                    <option value="SC" >SANTA CATARINA</option>
                                    <option value="SP" >SÃO PAULO</option>
                                    <option value="SE" >SERGIPE</option>
                                    <option value="TO" >TOCANTINS</option>
                                </select>
                                <div class="invalid-feedback">
                                    Por favor, selecione o estado.
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="cidade" class="form-label">
                                    <i class="bi bi-geo me-1"></i>Cidade
                                    <span class="text-danger required-field">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="cidade" name="cidade"
                                       value="" required>
                                <div class="invalid-feedback">
                                    Por favor, informe a cidade.
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="inscEst" class="form-label">
                                    <i class="bi bi-card-list me-1"></i>Inscrição Estadual
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="inscEst" name="inscEst"
                                       value="">
                                <div class="invalid-feedback">
                                    Por favor, informe a inscrição estadual.
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="inscMun" class="form-label">
                                    <i class="bi bi-geo-alt me-1"></i>Inscrição Municipal
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <input type="text" class="form-control upper-input" id="inscMun" name="inscMun"
                                       value="">
                                <div class="invalid-feedback">
                                    Por favor, informe a inscrição municipal.
                                </div>
                            </div>
                        
                        
                        <!-- Quarta linha: Segmento, Atividade Principal, Regime Estadual e Regime Federal -->
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="segmento" class="form-label">
                                    <i class="bi bi-tags me-1"></i>Segmento
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <div class="input-group">
                                    <select class="form-select" id="segmento" name="segmento">
                                        <option value="">Selecione o segmento</option>
                                        
                                        <option value="COMERCIO" >COMERCIO</option>
                                        
                                        <option value="SERVIÇO" >SERVIÇO</option>
                                        
                                    </select>
                                    <button class="btn btn-outline-secondary" type="button" onclick="window.open('/segmentos', '_blank')" title="Cadastrar novos segmentos">
                                        <i class="bi bi-plus-circle"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback">
                                    Por favor, selecione o segmento.
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="atividade" class="form-label">
                                    <i class="bi bi-briefcase me-1"></i>Atividade Principal
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <div class="input-group">
                                    <select class="form-select" id="atividade" name="atividade">
                                        <option value="">Selecione a atividade principal</option>
                                        
                                        <option value="FARMÁCIA" >FARMÁCIA</option>
                                        
                                        <option value="LOCAÇÃO" >LOCAÇÃO</option>
                                        
                                        <option value="TRANSPORTADORA" >TRANSPORTADORA</option>
                                        
                                        <option value="COMBUSTÍVEL" >COMBUSTÍVEL</option>
                                        
                                        <option value="CLINICA" >CLINICA</option>
                                        
                                        <option value="VARIEDADES" >VARIEDADES</option>
                                        
                                        <option value="ASSOCIAÇÃO" >ASSOCIAÇÃO</option>
                                        
                                        <option value="RESTAURANTE" >RESTAURANTE</option>
                                        
                                        <option value="ENTREGAS" >ENTREGAS</option>
                                        
                                        <option value="ADMINISTRATIVO" >ADMINISTRATIVO</option>
                                        
                                        <option value="MÉDICO" >MÉDICO</option>
                                        
                                        <option value="HOSPITALAR" >HOSPITALAR</option>
                                        
                                        <option value="GRÁFICA" >GRÁFICA</option>
                                        
                                        <option value="MANIPULAÇÃO" >MANIPULAÇÃO</option>
                                        
                                    </select>
                                    <button class="btn btn-outline-secondary" type="button" onclick="window.open('/atividades', '_blank')" title="Cadastrar novas atividades">
                                        <i class="bi bi-plus-circle"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback">
                                    Por favor, selecione a atividade principal.
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="regimeEstadual" class="form-label">
                                    <i class="bi bi-bank me-1"></i>Regime Estadual
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <select class="form-select" id="regimeEstadual" name="regimeEstadual">
                                    <option value="">Selecione o regime estadual</option>
                                    <option value="SIMPLES" >SIMPLES NACIONAL</option>
                                    <option value="NORMAL" >REGIME NORMAL</option>
                                    <option value="REGIME_ESPECIAL" >REGIME ESPECIAL</option>
                                </select>
                                <div class="invalid-feedback">
                                    Por favor, selecione o regime estadual.
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="regimeFederal" class="form-label">
                                    <i class="bi bi-percent me-1"></i>Regime Federal
                                    <span class="text-danger conditional-required">*</span>
                                </label>
                                <select class="form-select" id="regimeFederal" name="regimeFederal">
                                    <option value="">Selecione o regime federal</option>
                                    <option value="MEI" >MEI</option>
                                    <option value="SIMPLES_NACIONAL" >SIMPLES NACIONAL</option>
                                    <option value="LUCRO_PRESUMIDO" >LUCRO PRESUMIDO</option>
                                    <option value="LUCRO_REAL" >LUCRO REAL</option>
                                    <option value="REGIME_ESPECIAL" >REGIME ESPECIAL</option>
                                </select>
                                <div class="invalid-feedback">
                                    Por favor, selecione o regime federal.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bloco 2: Serviços Prestados pela Control -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-handshake me-2"></i>
                            Serviços Prestados pela Control
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Primeira linha: Checkboxes dos serviços -->
                        <div class="row">
                            <!-- BPO Financeiro -->
                            <div class="col-md-3 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="bpoFinanceiro" name="bpoFinanceiro" 
                                           >
                                    <label class="form-check-label" for="bpoFinanceiro">
                                        <i class="bi bi-graph-up me-1 text-info"></i>
                                        <strong>BPO Financeiro</strong>
                                    </label>
                                </div>
                            </div>
                            <!-- Departamento Contábil (CT) -->
                            <div class="col-md-3 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="ct" name="ct" 
                                           >
                                    <label class="form-check-label" for="ct">
                                        <i class="bi bi-calculator me-1" style="color: var(--control-primary);"></i>
                                        <strong>Departamento Contábil (CT)</strong>
                                    </label>
                                </div>
                            </div>
                            <!-- Departamento Fiscal (FS) -->
                            <div class="col-md-3 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="fs" name="fs" 
                                           >
                                    <label class="form-check-label" for="fs">
                                        <i class="bi bi-file-text me-1" style="color: var(--control-secondary);"></i>
                                        <strong>Departamento Fiscal (FS)</strong>
                                    </label>
                                </div>
                            </div>
                            <!-- Departamento Pessoal (DP) -->
                            <div class="col-md-3 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="dp" name="dp" 
                                           >
                                    <label class="form-check-label" for="dp">
                                        <i class="bi bi-people me-1 text-success"></i>
                                        <strong>Departamento Pessoal (DP)</strong>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Segunda linha: Doméstica, Data de Início, Perfil do Cliente, Sistema Utilizado, Gera arquivo do Sped -->
                        <div class="row">
                            <!-- Doméstica -->
                            <div class="col-md-2 mb-3">
                                <label for="domestica" class="form-label">
                                    <i class="bi bi-house me-1"></i>
                                    Doméstica
                                </label>
                                <select class="form-select" id="domestica" name="domestica" disabled>
                                    <option value="NÃO" selected>NÃO</option>
                                    <option value="SIM" >SIM</option>
                                </select>
                            </div>
                            
                            <!-- Data de Início dos Serviços -->
                            <div class="col-md-2 mb-3">
                                <label for="dataInicioServicos" class="form-label">
                                    <i class="bi bi-calendar-event me-1"></i>
                                    Data de Início dos Serviços
                                </label>
                                <input type="text" class="form-control" id="dataInicioServicos" name="dataInicioServicos" 
                                       value=""
                                       placeholder="MM/AAAA" pattern="^(0[1-9]|1[0-2])\/\d{4}$" maxlength="7"
                                       title="Formato: MM/AAAA (Ex: 08/2025)"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       data-bs-title="Digite apenas números. Formato: MM/AAAA">
                                <div class="form-text">
                                    <small class="text-muted">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Exemplo: 08/2025 para Agosto de 2025
                                    </small>
                                </div>
                            </div>

                            <!-- Perfil do Cliente -->
                            <div class="col-md-2 mb-3">
                                <label for="perfilCliente" class="form-label">
                                    <i class="bi bi-person-badge me-1"></i>
                                    Perfil do Cliente *
                                </label>
                                <select class="form-select" id="perfilCliente" name="perfilCliente" required>
                                    <option value="">Selecione um perfil</option>
                                    <option value="A" >A</option>
                                    <option value="B" >B</option>
                                    <option value="C" >C</option>
                                    <option value="D" >D</option>
                                </select>
                                <div class="invalid-feedback">
                                    Por favor, selecione o perfil do cliente.
                                </div>
                            </div>

                            <!-- Sistema Utilizado -->
                            <div class="col-md-2 mb-3">
                                <label for="sistemaUtilizado" class="form-label">
                                    <i class="bi bi-pc-display me-1"></i>
                                    Sistema Utilizado
                                </label>
                                <select class="form-select" id="sistemaUtilizado" name="sistemaUtilizado">
                                    <option value="">Selecione o sistema</option>
                                    
                                        
                                        <option value="FORTES" >FORTES</option>
                                        
                                        <option value="DOMÍNIO" >DOMÍNIO</option>
                                        
                                        <option value="SAGE" >SAGE</option>
                                        
                                        <option value="ALTERDATA" >ALTERDATA</option>
                                        
                                        <option value="ECONET" >ECONET</option>
                                        
                                        <option value="SISPAG" >SISPAG</option>
                                        
                                        <option value="FOLHAMATIC" >FOLHAMATIC</option>
                                        
                                        <option value="PROSOFT" >PROSOFT</option>
                                        
                                        <option value="SISTEMA PRÓPRIO" >SISTEMA PRÓPRIO</option>
                                        
                                        <option value="PLANILHAS EXCEL" >PLANILHAS EXCEL</option>
                                        
                                        <option value="SISTEMA ONLINE" >SISTEMA ONLINE</option>
                                        
                                        <option value="OUTROS" >OUTROS</option>
                                        
                                    
                                </select>
                            </div>

                            <!-- Gera arquivo do Sped -->
                            <div class="col-md-2 mb-3">
                                <label for="geraArquivoSped" class="form-label">
                                    <i class="bi bi-file-earmark-code me-1"></i>
                                    Gera arquivo do Sped
                                </label>
                                <select class="form-select" id="geraArquivoSped" name="geraArquivoSped">
                                    <option value="">Selecionar SIM/NÃO</option>
                                    <option value="SIM" >SIM</option>
                                    <option value="NÃO" >NÃO</option>
                                </select>
                            </div>
                        </div>

                        <!-- Terceira linha: Códigos dos sistemas -->
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="codDominio" class="form-label">
                                    <i class="bi bi-hash me-1"></i>
                                    # Cód. Domínio
                                </label>
                                <input type="text" class="form-control numbers-only" id="codDominio" name="codDominio" 
                                       value=""
                                       placeholder="Código Domínio" pattern="[0-9]*" title="Apenas números">
                            </div>

                            <div class="col-md-3 mb-3">
                                <label for="codFortesCt" class="form-label">
                                    <i class="bi bi-hash me-1"></i>
                                    # Cód. Fortes CT
                                </label>
                                <input type="text" class="form-control numbers-only" id="codFortesCt" name="codFortesCt" 
                                       value=""
                                       placeholder="Código CT" pattern="[0-9]*" title="Apenas números">
                            </div>

                            <div class="col-md-3 mb-3">
                                <label for="codFortesFs" class="form-label">
                                    <i class="bi bi-hash me-1"></i>
                                    # Cód. Fortes FS
                                </label>
                                <input type="text" class="form-control numbers-only" id="codFortesFs" name="codFortesFs" 
                                       value=""
                                       placeholder="Código FS" pattern="[0-9]*" title="Apenas números">
                            </div>

                            <div class="col-md-3 mb-3">
                                <label for="codFortesPs" class="form-label">
                                    <i class="bi bi-hash me-1"></i>
                                    # Cód. Fortes PS
                                </label>
                                <input type="text" class="form-control numbers-only" id="codFortesPs" name="codFortesPs" 
                                       value=""
                                       placeholder="Código PS" pattern="[0-9]*" title="Apenas números">
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Bloco 3: Quadro Societário -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-people me-2"></i>
                            Quadro Societário
                        </h5>
                    </div>
                    <div class="card-body">
            <!-- Campos removidos: E-MAIL SECUNDÁRIO, RESPONSÁVEL IMEDIATO -->
                        <div class="row">
                            <!-- BLOCO 3: QUADRO SOCIETÁRIO -->
                            <div class="col-12 mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-people-fill me-1"></i>SÓCIOS DA EMPRESA
                                    </label>
                                    <button type="button" 
                                            class="btn btn-outline-primary btn-sm" 
                                            id="btnAdicionarSocio"
                                            onclick="
                                                console.log('🔴 [CORREÇÃO 09] BOTÃO CLICADO - Verificando sócios ocultos');
                                                
                                                // CORREÇÃO 09: Primeiro verificar se há sócios estáticos ocultos (2-5)
                                                var sociosEstaticosOcultos = [];
                                                for (var i = 2; i <= 5; i++) {
                                                    var socioEstatico = document.getElementById('socio_' + i);
                                                    if (socioEstatico && socioEstatico.style.display === 'none') {
                                                        sociosEstaticosOcultos.push(i);
                                                    }
                                                }
                                                
                                                if (sociosEstaticosOcultos.length > 0) {
                                                    // Mostrar o primeiro sócio oculto
                                                    var proximoSocio = sociosEstaticosOcultos[0];
                                                    var socioElement = document.getElementById('socio_' + proximoSocio);
                                                    socioElement.style.display = 'block';
                                                    console.log('✅ [CORREÇÃO 09] Sócio', proximoSocio, 'revelado (estava oculto)');
                                                    
                                                    // Aplicar máscara CPF ao sócio revelado
                                                    var cpfInput = socioElement.querySelector('.cpf-mask');
                                                    if (cpfInput) {
                                                        if (cpfInput.value && cpfInput.value.length > 0) {
                                                            formatCPF(cpfInput);
                                                            console.log('🔧 [CORREÇÃO 09] CPF formatado no sócio revelado:', cpfInput.value);
                                                        }
                                                    }
                                                    
                                                    // Focar no primeiro campo do sócio revelado
                                                    var firstInput = socioElement.querySelector('input');
                                                    if (firstInput) firstInput.focus();
                                                    
                                                    return; // Sair da função - não criar sócio dinâmico
                                                }
                                                
                                                // Se chegou aqui, todos os sócios estáticos (2-5) já estão visíveis
                                                // Proceder com criação de sócio dinâmico (6+)
                                                console.log('🔧 [CORREÇÃO 09] Todos sócios estáticos visíveis - criando dinâmico');
                                                
                                                var container = document.getElementById('sociosContainer');
                                                if (!container) {
                                                    alert('Container não encontrado!');
                                                    return;
                                                }
                                                console.log('✅ Container encontrado');
                                                var socios = container.querySelectorAll('.socio-card');
                                                var total = socios.length;
                                                console.log('📊 Total sócios:', total);
                                                if (total >= 10) {
                                                    alert('Máximo 10 sócios!');
                                                    return;
                                                }
                                                var num = total + 1;
                                                var div = document.createElement('div');
                                                div.className = 'card border-light mb-2 socio-card';
                                                div.id = 'socio_' + num;
                                                div.innerHTML = '<div class=\&quot;card-body py-3\&quot;><div class=\&quot;d-flex justify-content-between align-items-center mb-2\&quot;><span class=\&quot;badge bg-primary\&quot;>Sócio ' + num + '</span><button type=\&quot;button\&quot; class=\&quot;btn btn-sm btn-outline-danger\&quot; onclick=\&quot;this.closest(\\\&quot;.socio-card\\\&quot;).remove();\&quot;>❌</button></div><div class=\&quot;row align-items-center\&quot;><div class=\&quot;col-md-3 mb-2\&quot;><label class=\&quot;form-label small mb-1\&quot;>Nome do Sócio</label><input type=\&quot;text\&quot; class=\&quot;form-control form-control-sm\&quot; name=\&quot;socio_' + num + '_nome\&quot; onkeyup=\&quot;this.value=this.value.toUpperCase()\&quot; placeholder=\&quot;Nome completo do sócio\&quot;></div><div class=\&quot;col-md-2 mb-2\&quot;><label class=\&quot;form-label small mb-1\&quot;>CPF</label><input type=\&quot;text\&quot; class=\&quot;form-control form-control-sm cpf-mask\&quot; name=\&quot;socio_' + num + '_cpf\&quot; placeholder=\&quot;000.000.000-00\&quot;></div><div class=\&quot;col-md-2 mb-2\&quot;><label class=\&quot;form-label small mb-1\&quot;>Data de Nascimento</label><input type=\&quot;date\&quot; class=\&quot;form-control form-control-sm\&quot; name=\&quot;socio_' + num + '_data_nascimento\&quot;></div><div class=\&quot;col-md-2 mb-2\&quot;><label class=\&quot;form-label small mb-1\&quot;>% de Quotas</label><input type=\&quot;number\&quot; class=\&quot;form-control form-control-sm\&quot; name=\&quot;socio_' + num + '_participacao\&quot; placeholder=\&quot;50.00\&quot; step=\&quot;0.01\&quot; min=\&quot;0\&quot; max=\&quot;100\&quot;></div><div class=\&quot;col-md-3 mb-2\&quot;><div class=\&quot;row\&quot;><div class=\&quot;col-6\&quot;><div class=\&quot;form-check\&quot;><input class=\&quot;form-check-input representante-legal\&quot; type=\&quot;radio\&quot; name=\&quot;representante_legal\&quot; value=\&quot;socio_' + num + '\&quot; id=\&quot;rep_legal_' + num + '\&quot;><label class=\&quot;form-check-label small\&quot; for=\&quot;rep_legal_' + num + '\&quot;>Representante Legal</label></div></div><div class=\&quot;col-6\&quot;><div class=\&quot;form-check\&quot;><input class=\&quot;form-check-input socio-admin\&quot; type=\&quot;checkbox\&quot; name=\&quot;socio_' + num + '_administrador\&quot; value=\&quot;1\&quot; id=\&quot;admin_' + num + '\&quot;><label class=\&quot;form-check-label small\&quot; for=\&quot;admin_' + num + '\&quot;>Sócio Administrador</label></div></div></div></div></div></div>';
                                                container.appendChild(div);
                                                
                                                // CORREÇÃO 07: Reaplicar máscaras aos novos campos CPF
                                                console.log('🔧 [CORREÇÃO 07] Aplicando máscara CPF ao sócio', num);
                                                var cpfInput = div.querySelector('.cpf-mask');
                                                if (cpfInput) {
                                                    // Event listener para input em tempo real
                                                    cpfInput.addEventListener('input', function() {
                                                        formatCPF(this);
                                                    });
                                                    
                                                    // Event listener para blur (quando sai do campo)
                                                    cpfInput.addEventListener('blur', function() {
                                                        if (this.value && this.value.length > 0) {
                                                            formatCPF(this);
                                                        }
                                                    });
                                                    
                                                    // Formatar se já tiver valor
                                                    if (cpfInput.value && cpfInput.value.length > 0) {
                                                        formatCPF(cpfInput);
                                                    }
                                                    
                                                    console.log('✅ [CORREÇÃO 07] Máscara CPF aplicada ao sócio', num);
                                                } else {
                                                    console.error('❌ [CORREÇÃO 07] Campo CPF não encontrado no sócio', num);
                                                }
                                                
                                                // Aplicar event listener para atualizar CPF do Representante Legal
                                                var radioInput = div.querySelector('.representante-legal');
                                                if (radioInput) {
                                                    radioInput.addEventListener('change', function() {
                                                        if (this.checked) {
                                                            atualizarCpfRepresentanteLegal();
                                                        }
                                                    });
                                                }
                                                
                                                // Aplicar event listener para atualizar CPF quando digitado
                                                if (cpfInput) {
                                                    cpfInput.addEventListener('input', function() {
                                                        // Verificar se este sócio é o representante legal selecionado
                                                        var radio = div.querySelector('.representante-legal');
                                                        if (radio && radio.checked) {
                                                            atualizarCpfRepresentanteLegal();
                                                        }
                                                    });
                                                }
                                                
                                                console.log('✅ [CORREÇÃO 09] Sócio dinâmico', num, 'adicionado com TODOS os campos e máscaras!');
                                                var input = div.querySelector('input');
                                                if (input) input.focus();
                                            ">
                                        <i class="bi bi-plus-circle me-1"></i>Adicionar Sócio
                                    </button>
                                </div>
                                
                                <!-- Container para os sócios -->
                                <div id="sociosContainer">
                                    <!-- Sócio 1 (sempre presente) -->
                                    <div class="card border-light mb-2 socio-card" id="socio_1">
                                        <div class="card-body py-3">
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome do Sócio</label>
                                                    <input type="text" class="form-control form-control-sm upper-input" 
                                                           name="socio_1_nome" id="socio_1_nome"
                                                           value=""
                                                           onkeyup="this.value=this.value.toUpperCase()"
                                                           placeholder="Nome completo do sócio">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">CPF</label>
                                                    <input type="text" class="form-control form-control-sm cpf-mask" 
                                                           name="socio_1_cpf" id="socio_1_cpf"
                                                           value=""
                                                           placeholder="000.000.000-00">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">Data de Nascimento</label>
                                                    <input type="date" class="form-control form-control-sm" 
                                                           name="socio_1_data_nascimento" id="socio_1_data_nascimento"
                                                           value="">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">% de Quotas</label>
                                                    <input type="number" class="form-control form-control-sm" 
                                                           name="socio_1_participacao" id="socio_1_participacao"
                                                           value=""
                                                           placeholder="50.00" step="0.01" min="0" max="100">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input representante-legal" type="radio" 
                                                                       name="representante_legal" value="socio_1" 
                                                                       id="rep_legal_1"
                                                                       >
                                                                <label class="form-check-label small" for="rep_legal_1">
                                                                    Representante Legal
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input socio-admin" type="checkbox" 
                                                                       name="socio_1_administrador" value="1" 
                                                                       id="admin_1"
                                                                       >
                                                                <label class="form-check-label small" for="admin_1">
                                                                    Sócio Administrador
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sócio 2 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 socio-card" id="socio_2" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-primary">Sócio 2</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.socio-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome do Sócio</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="socio_2_nome" id="socio_2_nome"
                                                           value=""
                                                           onkeyup="this.value=this.value.toUpperCase()"
                                                           placeholder="Nome completo do sócio">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">CPF</label>
                                                    <input type="text" class="form-control form-control-sm cpf-mask" 
                                                           name="socio_2_cpf" id="socio_2_cpf"
                                                           value=""
                                                           placeholder="000.000.000-00">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">Data de Nascimento</label>
                                                    <input type="date" class="form-control form-control-sm" 
                                                           name="socio_2_data_nascimento" id="socio_2_data_nascimento"
                                                           value="">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">% de Quotas</label>
                                                    <input type="number" class="form-control form-control-sm" 
                                                           name="socio_2_participacao" id="socio_2_participacao"
                                                           value=""
                                                           placeholder="50.00" step="0.01" min="0" max="100">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input representante-legal" type="radio" 
                                                                       name="representante_legal" value="socio_2" 
                                                                       id="rep_legal_2"
                                                                       >
                                                                <label class="form-check-label small" for="rep_legal_2">
                                                                    Representante Legal
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input socio-admin" type="checkbox" 
                                                                       name="socio_2_administrador" value="1" 
                                                                       id="admin_2"
                                                                       >
                                                                <label class="form-check-label small" for="admin_2">
                                                                    Sócio Administrador
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sócio 3 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 socio-card" id="socio_3" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-primary">Sócio 3</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.socio-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome do Sócio</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="socio_3_nome" id="socio_3_nome"
                                                           value=""
                                                           onkeyup="this.value=this.value.toUpperCase()"
                                                           placeholder="Nome completo do sócio">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">CPF</label>
                                                    <input type="text" class="form-control form-control-sm cpf-mask" 
                                                           name="socio_3_cpf" id="socio_3_cpf"
                                                           value=""
                                                           placeholder="000.000.000-00">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">Data de Nascimento</label>
                                                    <input type="date" class="form-control form-control-sm" 
                                                           name="socio_3_data_nascimento" id="socio_3_data_nascimento"
                                                           value="">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">% de Quotas</label>
                                                    <input type="number" class="form-control form-control-sm" 
                                                           name="socio_3_participacao" id="socio_3_participacao"
                                                           value=""
                                                           placeholder="50.00" step="0.01" min="0" max="100">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input representante-legal" type="radio" 
                                                                       name="representante_legal" value="socio_3" 
                                                                       id="rep_legal_3"
                                                                       >
                                                                <label class="form-check-label small" for="rep_legal_3">
                                                                    Representante Legal
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input socio-admin" type="checkbox" 
                                                                       name="socio_3_administrador" value="1" 
                                                                       id="admin_3"
                                                                       >
                                                                <label class="form-check-label small" for="admin_3">
                                                                    Sócio Administrador
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sócio 4 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 socio-card" id="socio_4" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-primary">Sócio 4</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.socio-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome do Sócio</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="socio_4_nome" id="socio_4_nome"
                                                           value=""
                                                           onkeyup="this.value=this.value.toUpperCase()"
                                                           placeholder="Nome completo do sócio">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">CPF</label>
                                                    <input type="text" class="form-control form-control-sm cpf-mask" 
                                                           name="socio_4_cpf" id="socio_4_cpf"
                                                           value=""
                                                           placeholder="000.000.000-00">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">Data de Nascimento</label>
                                                    <input type="date" class="form-control form-control-sm" 
                                                           name="socio_4_data_nascimento" id="socio_4_data_nascimento"
                                                           value="">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">% de Quotas</label>
                                                    <input type="number" class="form-control form-control-sm" 
                                                           name="socio_4_participacao" id="socio_4_participacao"
                                                           value=""
                                                           placeholder="50.00" step="0.01" min="0" max="100">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input representante-legal" type="radio" 
                                                                       name="representante_legal" value="socio_4" 
                                                                       id="rep_legal_4"
                                                                       >
                                                                <label class="form-check-label small" for="rep_legal_4">
                                                                    Representante Legal
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input socio-admin" type="checkbox" 
                                                                       name="socio_4_administrador" value="1" 
                                                                       id="admin_4"
                                                                       >
                                                                <label class="form-check-label small" for="admin_4">
                                                                    Sócio Administrador
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sócio 5 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 socio-card" id="socio_5" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-primary">Sócio 5</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.socio-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome do Sócio</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="socio_5_nome" id="socio_5_nome"
                                                           value=""
                                                           onkeyup="this.value=this.value.toUpperCase()"
                                                           placeholder="Nome completo do sócio">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">CPF</label>
                                                    <input type="text" class="form-control form-control-sm cpf-mask" 
                                                           name="socio_5_cpf" id="socio_5_cpf"
                                                           value=""
                                                           placeholder="000.000.000-00">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">Data de Nascimento</label>
                                                    <input type="date" class="form-control form-control-sm" 
                                                           name="socio_5_data_nascimento" id="socio_5_data_nascimento"
                                                           value="">
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label class="form-label small mb-1">% de Quotas</label>
                                                    <input type="number" class="form-control form-control-sm" 
                                                           name="socio_5_participacao" id="socio_5_participacao"
                                                           value=""
                                                           placeholder="50.00" step="0.01" min="0" max="100">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input representante-legal" type="radio" 
                                                                       name="representante_legal" value="socio_5" 
                                                                       id="rep_legal_5"
                                                                       >
                                                                <label class="form-check-label small" for="rep_legal_5">
                                                                    Representante Legal
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input socio-admin" type="checkbox" 
                                                                       name="socio_5_administrador" value="1" 
                                                                       id="admin_5"
                                                                       >
                                                                <label class="form-check-label small" for="admin_5">
                                                                    Sócio Administrador
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                <!-- Campo removido: E-MAILS ADICIONAIS DOS SÓCIOS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bloco 4: Contatos -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="bi bi-person-badge me-2"></i>
                            Contatos
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- CONTATOS DA EMPRESA -->
                            <div class="col-12 mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <label class="form-label fw-bold">
                                        <i class="bi bi-telephone-fill me-1"></i>CONTATOS DA EMPRESA
                                    </label>
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="adicionarContato()">
                                        <i class="bi bi-plus-circle me-1"></i>Adicionar Contato
                                    </button>
                                </div>
                                
                                <!-- Container para os contatos -->
                                <div id="contatosContainer">
                                    <!-- Contato 1 (sempre presente) -->
                                    <div class="card border-light mb-2 contato-card" id="contato_1">
                                        <div class="card-body py-3">
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_1_nome" id="contato_1_nome"
                                                           value=""
                                                           placeholder="Nome completo do contato">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Cargo</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_1_cargo" id="contato_1_cargo"
                                                           value=""
                                                           placeholder="Ex: Gerente, Diretor, Sócio">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Telefone</label>
                                                    <input type="tel" class="form-control form-control-sm phone-mask" 
                                                           name="contato_1_telefone" id="contato_1_telefone"
                                                           value=""
                                                           placeholder="(85) 99999-9999">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">E-mail</label>
                                                    <input type="email" class="form-control form-control-sm" 
                                                           name="contato_1_email" id="contato_1_email"
                                                           value=""
                                                           placeholder="contato@empresa.com">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Contato 2 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 contato-card" id="contato_2" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-success">Contato 2</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.contato-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_2_nome" id="contato_2_nome"
                                                           value=""
                                                           placeholder="Nome completo do contato">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Cargo</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_2_cargo" id="contato_2_cargo"
                                                           value=""
                                                           placeholder="Ex: Gerente, Diretor, Sócio">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Telefone</label>
                                                    <input type="tel" class="form-control form-control-sm phone-mask" 
                                                           name="contato_2_telefone" id="contato_2_telefone"
                                                           value=""
                                                           placeholder="(85) 99999-9999">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">E-mail</label>
                                                    <input type="email" class="form-control form-control-sm" 
                                                           name="contato_2_email" id="contato_2_email"
                                                           value=""
                                                           placeholder="contato@empresa.com">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Contato 3 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 contato-card" id="contato_3" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-success">Contato 3</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.contato-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_3_nome" id="contato_3_nome"
                                                           value=""
                                                           placeholder="Nome completo do contato">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Cargo</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_3_cargo" id="contato_3_cargo"
                                                           value=""
                                                           placeholder="Ex: Gerente, Diretor, Sócio">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Telefone</label>
                                                    <input type="tel" class="form-control form-control-sm phone-mask" 
                                                           name="contato_3_telefone" id="contato_3_telefone"
                                                           value=""
                                                           placeholder="(85) 99999-9999">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">E-mail</label>
                                                    <input type="email" class="form-control form-control-sm" 
                                                           name="contato_3_email" id="contato_3_email"
                                                           value=""
                                                           placeholder="contato@empresa.com">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Contato 4 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 contato-card" id="contato_4" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-success">Contato 4</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.contato-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_4_nome" id="contato_4_nome"
                                                           value=""
                                                           placeholder="Nome completo do contato">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Cargo</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_4_cargo" id="contato_4_cargo"
                                                           value=""
                                                           placeholder="Ex: Gerente, Diretor, Sócio">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Telefone</label>
                                                    <input type="tel" class="form-control form-control-sm phone-mask" 
                                                           name="contato_4_telefone" id="contato_4_telefone"
                                                           value=""
                                                           placeholder="(85) 99999-9999">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">E-mail</label>
                                                    <input type="email" class="form-control form-control-sm" 
                                                           name="contato_4_email" id="contato_4_email"
                                                           value=""
                                                           placeholder="contato@empresa.com">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Contato 5 (CORREÇÃO 09: inicialmente oculto) -->
                                    <div class="card border-light mb-2 contato-card" id="contato_5" style="display: none;">
                                        <div class="card-body py-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge bg-success">Contato 5</span>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="this.closest('.contato-card').remove()">❌</button>
                                            </div>
                                            <div class="row align-items-center">
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Nome</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_5_nome" id="contato_5_nome"
                                                           value=""
                                                           placeholder="Nome completo do contato">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Cargo</label>
                                                    <input type="text" class="form-control form-control-sm" 
                                                           name="contato_5_cargo" id="contato_5_cargo"
                                                           value=""
                                                           placeholder="Ex: Gerente, Diretor, Sócio">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">Telefone</label>
                                                    <input type="tel" class="form-control form-control-sm phone-mask" 
                                                           name="contato_5_telefone" id="contato_5_telefone"
                                                           value=""
                                                           placeholder="(85) 99999-9999">
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <label class="form-label small mb-1">E-mail</label>
                                                    <input type="email" class="form-control form-control-sm" 
                                                           name="contato_5_email" id="contato_5_email"
                                                           value=""
                                                           placeholder="contato@empresa.com">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bloco 5: Senhas -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-key me-2"></i>Senhas
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Linha 1: CNPJ Acesso Simples Nacional, CPF do Representante Legal, Código de Acesso Simples Nacional, Senha ISS -->
                        <div class="row mb-3">
                            <div class="col-md-3 mb-2">
                                <label for="cnpjAcessoSn" class="form-label small">CNPJ Acesso Simples Nacional</label>
                                <input type="text" class="form-control form-control-sm cnpj-mask" 
                                       id="cnpjAcessoSn" name="cnpjAcessoSn" 
                                       value="" 
                                       placeholder="00.000.000/0001-00">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="cpfRepLegal" class="form-label small">CPF do Representante Legal</label>
                                <input type="text" class="form-control form-control-sm cpf-mask" 
                                       id="cpfRepLegal" name="cpfRepLegal" 
                                       value="" 
                                       placeholder="000.000.000-00">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="codigoAcessoSn" class="form-label small">Código de Acesso Simples Nacional</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="codigoAcessoSn" name="codigoAcessoSn" 
                                       value="" 
                                       placeholder="Código de Acesso">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="senhaIss" class="form-label small">Senha ISS</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaIss" name="senhaIss" 
                                       value="" 
                                       placeholder="Senha ISS">
                            </div>
                        </div>

                        <!-- Linha 2: Senha SEFIN, Senha SEUMA, Acesso EmpWeb, Senha EmpWeb -->
                        <div class="row mb-3">
                            <div class="col-md-3 mb-2">
                                <label for="senhaSefin" class="form-label small">Senha SEFIN</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaSefin" name="senhaSefin" 
                                       value="" 
                                       placeholder="Senha SEFIN">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="senhaSeuma" class="form-label small">Senha SEUMA</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaSeuma" name="senhaSeuma" 
                                       value="" 
                                       placeholder="Senha SEUMA">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="acessoEmpWeb" class="form-label small">Acesso EmpWeb</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="acessoEmpWeb" name="acessoEmpWeb" 
                                       value="" 
                                       placeholder="Login EmpWeb">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="senhaEmpWeb" class="form-label small">Senha EmpWeb</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaEmpWeb" name="senhaEmpWeb" 
                                       value="" 
                                       placeholder="Senha EmpWeb">
                            </div>
                        </div>

                        <!-- Linha 3: Login ANVISA Empresa, Senha ANVISA Empresa, Login ANVISA Gestor, Senha ANVISA Gestor -->
                        <div class="row mb-3">
                            <div class="col-md-3 mb-2">
                                <label for="anvisaEmpresa" class="form-label small">Login ANVISA Empresa</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="anvisaEmpresa" name="anvisaEmpresa" 
                                       value="" 
                                       placeholder="Login ANVISA Empresa">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="senhaAnvisaEmpresa" class="form-label small">Senha ANVISA Empresa</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaAnvisaEmpresa" name="senhaAnvisaEmpresa" 
                                       value="" 
                                       placeholder="Senha ANVISA Empresa">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="anvisaGestor" class="form-label small">Login ANVISA Gestor</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="anvisaGestor" name="anvisaGestor" 
                                       value="" 
                                       placeholder="Login ANVISA Gestor">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="senhaAnvisaGestor" class="form-label small">Senha ANVISA Gestor</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaAnvisaGestor" name="senhaAnvisaGestor" 
                                       value="" 
                                       placeholder="Senha ANVISA Gestor">
                            </div>
                        </div>

                        <!-- Linha 4: Acesso CRF, Senha FAP/INSS -->
                        <div class="row mb-3">
                            <div class="col-md-3 mb-2">
                                <label for="acessoCrf" class="form-label small">Acesso CRF</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="acessoCrf" name="acessoCrf" 
                                       value="" 
                                       placeholder="CRF do Responsável">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label for="senhaFapInss" class="form-label small">Senha FAP/INSS</label>
                                <input type="text" class="form-control form-control-sm" 
                                       id="senhaFapInss" name="senhaFapInss" 
                                       value="" 
                                       placeholder="Senha FAP/INSS">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bloco 6: Procurações -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-file-earmark-text me-2"></i>Procurações
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Procurações em uma única linha -->
                        <div class="row mb-3">
                            <!-- Proc. Receita -->
                            <div class="col-md mb-2">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" 
                                           id="procReceita" name="procReceita" 
                                           onchange="toggleProcuracaoData('procReceita', 'dataProcReceita')"
                                           >
                                    <label class="form-check-label small" for="procReceita">
                                        <strong>Proc. Receita</strong>
                                    </label>
                                </div>
                                <input type="text" class="form-control form-control-sm date-mask" 
                                       id="dataProcReceita" name="dataProcReceita" 
                                       value="" 
                                       placeholder="DD/MM/AAAA">
                            </div>

                            <!-- Proc. DTe -->
                            <div class="col-md mb-2">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" 
                                           id="procDte" name="procDte" 
                                           onchange="toggleProcuracaoData('procDte', 'dataProcDte')"
                                           >
                                    <label class="form-check-label small" for="procDte">
                                        <strong>Proc. DTe</strong>
                                    </label>
                                </div>
                                <input type="text" class="form-control form-control-sm date-mask" 
                                       id="dataProcDte" name="dataProcDte" 
                                       value="" 
                                       placeholder="DD/MM/AAAA">
                            </div>

                            <!-- Proc. Caixa -->
                            <div class="col-md mb-2">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" 
                                           id="procCaixa" name="procCaixa" 
                                           onchange="toggleProcuracaoData('procCaixa', 'dataProcCaixa')"
                                           >
                                    <label class="form-check-label small" for="procCaixa">
                                        <strong>Proc. Caixa</strong>
                                    </label>
                                </div>
                                <input type="text" class="form-control form-control-sm date-mask" 
                                       id="dataProcCaixa" name="dataProcCaixa" 
                                       value="" 
                                       placeholder="DD/MM/AAAA">
                            </div>

                            <!-- Proc. Emp. Web -->
                            <div class="col-md mb-2">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" 
                                           id="procEmpWeb" name="procEmpWeb" 
                                           onchange="toggleProcuracaoData('procEmpWeb', 'dataProcEmpWeb')"
                                           >
                                    <label class="form-check-label small" for="procEmpWeb">
                                        <strong>Proc. Emp. Web</strong>
                                    </label>
                                </div>
                                <input type="text" class="form-control form-control-sm date-mask" 
                                       id="dataProcEmpWeb" name="dataProcEmpWeb" 
                                       value="" 
                                       placeholder="DD/MM/AAAA">
                            </div>

                            <!-- Proc. DET -->
                            <div class="col-md mb-2">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" 
                                           id="procDet" name="procDet" 
                                           onchange="toggleProcuracaoData('procDet', 'dataProcDet')"
                                           >
                                    <label class="form-check-label small" for="procDet">
                                        <strong>Proc. DET</strong>
                                    </label>
                                </div>
                                <input type="text" class="form-control form-control-sm date-mask" 
                                       id="dataProcDet" name="dataProcDet" 
                                       value="" 
                                       placeholder="DD/MM/AAAA">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bloco 7: Observações e Dados Adicionais -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-chat-left-text me-2"></i>Observações e Dados Adicionais
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Observações Gerais -->
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="observacoes" class="form-label">
                                    <i class="fas fa-sticky-note me-2"></i>OBSERVAÇÕES GERAIS
                                </label>
                                <textarea class="form-control" id="observacoes" name="observacoes" rows="4" 
                                          placeholder="Digite aqui observações gerais sobre o cliente..."></textarea>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Este campo será exibido no "Ver Detalhes" do cliente para consulta rápida
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!-- status do cliente -->
                            <div class="col-md-6 mb-3">
                                <label for="statusCliente" class="form-label">STATUS DO CLIENTE</label>
                                <select class="form-select" id="statusCliente" name="statusCliente">
                                    <option value="ativo" >Ativo</option>
                                    <option value="inativo" >Inativo</option>
                                </select>
                            </div>
                            <!-- Data da última atualização -->
                            <div class="col-md-6 mb-3">
                                <label for="ultimaAtualizacao" class="form-label">Última atualização</label>
                                <input type="datetime-local" class="form-control" id="ultimaAtualizacao" name="ultimaAtualizacao" 
                                       value="" readonly>
                                <div class="form-text">Atualizado automaticamente</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botões de ação -->
                
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <button type="submit" class="btn btn-primary me-3">
                                    <i class="bi bi-check-lg me-1"></i>
                                    Salvar Cliente
                                </button>
                                <a href="/" class="btn btn-secondary">
                                    <i class="bi bi-x-lg me-1"></i>
                                    Cancelar
                                </a>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
            </form>
        </div>
    </div>
</div>

<!-- Modal de confirmação de exclusão -->


<script>
// =============================================================================
// (Removido bloco duplicado de DOMContentLoaded; lógica consolidada abaixo)
// =============================================================================

// Aplicar máscaras aos campos existentes
function formatPhone(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{4,5})(\d{4})$/, '$1-$2');
    }
    input.value = value;
}

// Formatação de CPF - CORREÇÃO 07: Versão melhorada
function formatCPF(input) {
    // Salvar posição do cursor
    const cursorPos = input.selectionStart;
    const valueLength = input.value.length;
    
    // Remover tudo que não é dígito
    let value = input.value.replace(/\D/g, '');
    
    // Aplicar formatação apenas se tiver dígitos
    if (value.length > 0) {
        // Limitar a 11 dígitos
        if (value.length > 11) {
            value = value.substring(0, 11);
        }
        
        // Aplicar formatação progressiva
        if (value.length >= 4) {
            value = value.replace(/^(\d{3})(\d)/, '$1.$2');
        }
        if (value.length >= 8) {
            value = value.replace(/^(\d{3}\.\d{3})(\d)/, '$1.$2');
        }
        if (value.length >= 12) {
            value = value.replace(/^(\d{3}\.\d{3}\.\d{3})(\d)/, '$1-$2');
        }
    }
    
    // Atualizar valor
    input.value = value;
    
    // Calcular nova posição do cursor baseado na diferença de tamanho
    const lengthDiff = value.length - valueLength;
    const newCursorPos = Math.min(Math.max(cursorPos + lengthDiff, 0), value.length);
    
    // Restaurar posição do cursor
    if (input.setSelectionRange) {
        setTimeout(() => {
            input.setSelectionRange(newCursorPos, newCursorPos);
        }, 0);
    }
}

// CORREÇÃO 07: Função utilitária para reaplicar formatação CPF em todos os campos
function reaplicarFormatacaoCPF() {
    console.log('🔧 [CORREÇÃO 07] Reaplicando formatação CPF em todos os campos...');
    
    const camposCpf = document.querySelectorAll('.cpf-mask, input[name*="_cpf"]');
    let contador = 0;
    
    camposCpf.forEach(function(input) {
        if (input.value && input.value.length > 0) {
            const valorAntes = input.value;
            formatCPF(input);
            
            if (valorAntes !== input.value) {
                console.log('✅ [CORREÇÃO 07] CPF reformatado:', input.name || input.id, valorAntes, '→', input.value);
                contador++;
            }
        }
        
        // Garantir que tem event listeners
        if (!input.hasAttribute('data-cpf-listener')) {
            input.addEventListener('input', function() {
                formatCPF(this);
            });
            
            input.addEventListener('blur', function() {
                if (this.value && this.value.length > 0) {
                    formatCPF(this);
                }
            });
            
            input.setAttribute('data-cpf-listener', 'true');
        }
    });
    
    console.log(`✅ [CORREÇÃO 07] Reaplicação concluída: ${contador} campos reformatados de ${camposCpf.length} encontrados`);
    return contador;
}

// Formatação de CNPJ
function formatCNPJ(input) {
    // Salvar posição do cursor
    const cursorPos = input.selectionStart;
    const valueLength = input.value.length;
    
    // Remover tudo que não é dígito
    let value = input.value.replace(/\D/g, '');
    
    // Aplicar formatação apenas se tiver dígitos
    if (value.length > 0) {
        // Limitar a 14 dígitos
        if (value.length > 14) {
            value = value.substring(0, 14);
        }
        
        // Aplicar formatação progressiva para CNPJ: 00.000.000/0000-00
        if (value.length >= 3) {
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
        }
        if (value.length >= 6) {
            value = value.replace(/^(\d{2}\.\d{3})(\d)/, '$1.$2');
        }
        if (value.length >= 9) {
            value = value.replace(/^(\d{2}\.\d{3}\.\d{3})(\d)/, '$1/$2');
        }
        if (value.length >= 13) {
            value = value.replace(/^(\d{2}\.\d{3}\.\d{3}\/\d{4})(\d)/, '$1-$2');
        }
    }
    
    // Atualizar valor
    input.value = value;
    
    // Calcular nova posição do cursor baseado na diferença de tamanho
    const lengthDiff = value.length - valueLength;
    const newCursorPos = Math.min(Math.max(cursorPos + lengthDiff, 0), value.length);
    
    // Restaurar posição do cursor
    if (input.setSelectionRange) {
        setTimeout(() => {
            input.setSelectionRange(newCursorPos, newCursorPos);
        }, 0);
    }
}

// Formatação dinâmica de CPF/CNPJ
function formatCPFCNPJ(input) {
    const value = input.value.replace(/\D/g, '');
    
    if (value.length <= 11) {
        // Formatar como CPF
        formatCPF(input);
    } else {
        // Formatar como CNPJ
        formatCNPJ(input);
    }
}

// Formatação de Data (DD/MM/AAAA)
function formatDate(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length <= 8) {
        value = value.replace(/(\d{2})(\d)/, '$1/$2');
        value = value.replace(/(\d{2})\/(\d{2})(\d)/, '$1/$2/$3');
    }
    input.value = value;
}

// Aplicar máscaras aos campos existentes
document.addEventListener('DOMContentLoaded', function() {
    // =============================================================
    // CORREÇÃO: CPF/CNPJ -> Label + Doméstica (IMPLEMENTAÇÃO SIMPLES)
    // =============================================================
    console.log('� DOM carregado - configurando CPF/CNPJ e Doméstica');
    
    function atualizarCpfCnpjEDomestica() {
        const cpfCnpjInput = document.getElementById('cpfCnpj');
        const domesticaSelect = document.getElementById('domestica');
        const labelCpfCnpj = document.querySelector('label[for="cpfCnpj"]');
        
        if (!cpfCnpjInput || !domesticaSelect) {
            console.log('❌ Campos não encontrados');
            return;
        }
        
        // Aplicar formatação dinâmica primeiro
        formatCPFCNPJ(cpfCnpjInput);
        
        const valor = cpfCnpjInput.value.replace(/\D/g, ''); // Remove não-dígitos
        console.log('📋 Processando:', valor, '- Length:', valor.length);
        
        // Atualizar label e controlar Doméstica
        if (valor.length === 11) {
            // É CPF
            console.log('👤 CPF detectado - 11 dígitos');
            if (labelCpfCnpj) {
                labelCpfCnpj.innerHTML = '<i class="bi bi-person me-1"></i>CPF <span class="text-danger">*</span>';
            }
            domesticaSelect.disabled = false;
            console.log('✅ DOMÉSTICA HABILITADA para CPF');
        } else if (valor.length === 14) {
            // É CNPJ
            console.log('🏢 CNPJ detectado - 14 dígitos');
            if (labelCpfCnpj) {
                labelCpfCnpj.innerHTML = '<i class="bi bi-building me-1"></i>CNPJ <span class="text-danger">*</span>';
            }
            domesticaSelect.disabled = true;
            domesticaSelect.value = 'NÃO';
            console.log('🏢 Doméstica desabilitada para CNPJ');
        } else {
            // Incompleto
            console.log('⏳ Documento incompleto');
            if (labelCpfCnpj) {
                labelCpfCnpj.innerHTML = '<i class="bi bi-card-text me-1"></i>CPF/CNPJ <span class="text-danger">*</span>';
            }
            domesticaSelect.disabled = true;
            domesticaSelect.value = 'NÃO';
            console.log('❌ Doméstica desabilitada - incompleto');
        }
        
        console.log('📊 Estado final: disabled =', domesticaSelect.disabled, 'valor:', domesticaSelect.value);
    }
    
    // Configurar eventos
    const cpfCnpjInput = document.getElementById('cpfCnpj');
    if (cpfCnpjInput) {
        cpfCnpjInput.addEventListener('input', atualizarCpfCnpjEDomestica);
        cpfCnpjInput.addEventListener('change', atualizarCpfCnpjEDomestica);
        cpfCnpjInput.addEventListener('blur', atualizarCpfCnpjEDomestica);
        
        // Estado inicial
        atualizarCpfCnpjEDomestica();
        
        console.log('✅ Eventos configurados com sucesso!');
    } else {
        console.error('❌ Campo CPF/CNPJ não encontrado!');
    }
    
    // =============================================================
    // RESTANTE DAS CONFIGURAÇÕES
    // =============================================================
    
    // CORREÇÃO 07: Aplicar máscara de CPF melhorada
    document.querySelectorAll('.cpf-mask').forEach(function(input) {
        // Formatar valores já preenchidos (dados existentes)
        if (input.value && input.value.length > 0) {
            formatCPF(input);
            console.log('🔧 [CORREÇÃO 07] CPF formatado em campo preexistente:', input.name, '→', input.value);
        }
        
        // Remover event listeners duplicados se existirem
        if (input.hasAttribute('data-cpf-listener')) {
            return; // Já tem listeners aplicados
        }
        
        // Aplicar event listener para formatação em tempo real
        input.addEventListener('input', function(e) {
            formatCPF(this);
        });
        
        // Aplicar event listener para formatação quando sai do campo
        input.addEventListener('blur', function(e) {
            if (this.value && this.value.length > 0) {
                formatCPF(this);
                console.log('🔧 [CORREÇÃO 07] CPF formatado no blur:', this.name, '→', this.value);
            }
        });
        
        // Aplicar event listener para formatação ao colar
        input.addEventListener('paste', function(e) {
            setTimeout(() => {
                formatCPF(this);
                console.log('🔧 [CORREÇÃO 07] CPF formatado após paste:', this.name, '→', this.value);
            }, 10);
        });
        
        // Marcar como processado
        input.setAttribute('data-cpf-listener', 'true');
    });
    
    // Aplicar máscara de telefone
    document.querySelectorAll('.phone-mask').forEach(function(input) {
        input.addEventListener('input', function() {
            formatPhone(this);
        });
    });

    // Aplicar máscara de data (DD/MM/AAAA)
    document.querySelectorAll('.date-mask').forEach(function(input) {
        input.addEventListener('input', function() {
            formatDate(this);
        });
    });

    // Funcionalidade para campos que só aceitam números
    document.querySelectorAll('.numbers-only').forEach(function(input) {
        input.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    });

    // Máscara para data MM/AAAA - CORREÇÃO 05
    const dataInicioInput = document.getElementById('dataInicioServicos');
    if (dataInicioInput) {
        // Função para aplicar máscara MM/AAAA
        function aplicarMascaraMMAAAA(input) {
            let value = input.value.replace(/\D/g, ''); // Remove tudo que não é dígito
            
            // Limita a 6 dígitos (MMAAAA)
            value = value.substring(0, 6);
            
            // Aplica máscara MM/AAAA
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 6);
            }
            
            return value;
        }
        
        // Event listeners para capturar todas as formas de entrada
        dataInicioInput.addEventListener('input', function() {
            this.value = aplicarMascaraMMAAAA(this);
            console.log('🔍 [CORREÇÃO 05] Máscara aplicada:', this.value);
        });
        
        dataInicioInput.addEventListener('keyup', function() {
            this.value = aplicarMascaraMMAAAA(this);
        });
        
        dataInicioInput.addEventListener('paste', function(e) {
            setTimeout(() => {
                this.value = aplicarMascaraMMAAAA(this);
            }, 10);
        });
        
        // Validação adicional
        dataInicioInput.addEventListener('blur', function() {
            const value = this.value;
            if (value && !value.match(/^(0[1-9]|1[0-2])\/\d{4}$/)) {
                console.warn('⚠️ [CORREÇÃO 05] Formato inválido:', value);
            }
        });
        
        console.log('✅ [CORREÇÃO 05] Máscara MM/AAAA configurada');
    }

    // Configurar controle de representante legal (apenas um pode ser selecionado)
    setTimeout(function() {
        configurarControleSocios();
    }, 100);

    // Inicializar estado dos campos de procuração
    inicializarProcuracoes();
    console.log('📋 Procurações inicializadas');

    // Inicializar validação de campos obrigatórios
    inicializarValidacaoCampos();
    console.log('✅ Validação de campos inicializada');

    // Adicionar validação no submit do formulário
    const form = document.querySelector('form.needs-validation');
    if (form) {
        form.addEventListener('submit', function(e) {
            console.log('📝 Submit do formulário interceptado');
            
            // Sempre adicionar classe para mostrar validação visual
            form.classList.add('was-validated');
            
            if (!validarFormulario(this)) {
                e.preventDefault();
                e.stopPropagation();
                console.log('❌ Submit cancelado devido a erros de validação');
                return false;
            }
            
            console.log('✅ Formulário válido, enviando...');
        });
        
        console.log('✅ Event listener de submit adicionado');
    } else {
        console.error('❌ Formulário não encontrado!');
    }

    // =============================================================
    // CORREÇÃO 09: Controle de Visibilidade dos Sócios
    // =============================================================
    console.log('🔧 [CORREÇÃO 09] Configurando visibilidade inicial dos sócios');
    
    // Função para mostrar sócios com dados
    function mostrarSociosComDados() {
        
        console.log('📝 [CORREÇÃO 09] Novo cliente - apenas Sócio 1 visível');
        
    }
    
    // Função para mostrar contatos com dados
    function mostrarContatosComDados() {
        
        console.log('📝 [CORREÇÃO 09] Novo cliente - apenas Contato 1 visível');
        
    }
    
    // Executar após um pequeno delay para garantir que DOM esteja totalmente carregado
    setTimeout(mostrarSociosComDados, 50);
    setTimeout(mostrarContatosComDados, 60);

    // Carregar dados dos sócios e contatos se estiver editando
    

    // Forçar caixa alta nos inputs
    document.querySelectorAll('.upper-input').forEach(function(input) {
        input.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
    });
    console.log('✅ Inputs uppercase configurados');
    
    // CORREÇÃO 07: Reaplicar formatação CPF após carregamento completo
    setTimeout(function() {
        reaplicarFormatacaoCPF();
        console.log('🔧 [CORREÇÃO 07] Formatação CPF reaplicada após carregamento completo');
    }, 2000);
});

// Função para configurar controles dos sócios
function configurarControleSocios() {
    console.log('👥 Configurando controles dos sócios');
    
    // TESTE: Verificar se função adicionarSocio está acessível
    console.log('🧪 TESTE: Função adicionarSocio existe?', typeof adicionarSocio === 'function');
    console.log('🧪 TESTE: numeroSocios inicial:', numeroSocios);
    
    // Adicionar eventos para todos os radio buttons de representante legal existentes
    document.querySelectorAll('.representante-legal').forEach(function(radio) {
        radio.addEventListener('change', function() {
            if (this.checked) {
                console.log('✅ Representante legal selecionado:', this.value);
            }
        });
    });
    
    console.log('✅ Controles de sócios configurados');
}

// Variável global para controlar o número de sócios
let numeroSocios = 1;

// Variável global para controlar o número de contatos
let numeroContatos = 1;

    // 🔍 SISTEMA SIMPLIFICADO - Botão com JavaScript inline
    console.log('✅ Sistema básico carregado');

// Função para remover sócio (CORRIGIDA)
    // ✅ Sistema pronto para uso
    const container = document.getElementById('sociosContainer');
    if (!container) return;
    
    const sociosCards = container.querySelectorAll('[id^="socio_"]');
    numeroSocios = sociosCards.length;
    
    console.log(`🔄 Numeração atualizada - Total de sócios: ${numeroSocios}`);
}

// FOCO NO PROBLEMA: QUADRO SOCIETÁRIO - VERSÃO ULTRA SIMPLES
function carregarSocios(dadosCliente) {
    console.log('� [CORREÇÃO 14] VERSÃO ULTRA SIMPLES - FOCO QUADRO SOCIETÁRIO');
    console.log('� CARREGANDO SÓCIOS - VERSÃO ULTRA SIMPLES');
    
    if (!dadosCliente) {
        console.error('❌ ERRO: Dados do cliente não fornecidos');
        return;
    }
    
    // FORÇAR criação de 3 cards imediatamente
    console.log('🔧 FORÇANDO criação de 3 cards para os 3 sócios');
    
    // Card 2
    setTimeout(() => {
        adicionarSocio();
        // Preencher dados do sócio 2
        const nome2 = dadosCliente.socio_2_nome;
        const cpf2 = dadosCliente.socio_2_cpf;
        const nasc2 = dadosCliente.socio_2_data_nascimento;
        const part2 = dadosCliente.socio_2_participacao;
        
        if (nome2) {
            const inputNome2 = document.querySelector('input[name="socio_2_nome"]');
            const inputCpf2 = document.querySelector('input[name="socio_2_cpf"]');
            const inputNasc2 = document.querySelector('input[name="socio_2_data_nascimento"]');
            const inputPart2 = document.querySelector('input[name="socio_2_participacao"]');
            
            if (inputNome2) inputNome2.value = nome2;
            if (inputCpf2) inputCpf2.value = cpf2 || '';
            if (inputNasc2) inputNasc2.value = nasc2 || '';
            if (inputPart2) inputPart2.value = part2 || '';
            
            console.log(`✅ Preenchido sócio 2: ${nome2}`);
        }
    }, 100);
    
    // Card 3
    setTimeout(() => {
        adicionarSocio();
        // Preencher dados do sócio 3
        const nome3 = dadosCliente.socio_3_nome;
        const cpf3 = dadosCliente.socio_3_cpf;
        const nasc3 = dadosCliente.socio_3_data_nascimento;
        const part3 = dadosCliente.socio_3_participacao;
        
        if (nome3) {
            const inputNome3 = document.querySelector('input[name="socio_3_nome"]');
            const inputCpf3 = document.querySelector('input[name="socio_3_cpf"]');
            const inputNasc3 = document.querySelector('input[name="socio_3_data_nascimento"]');
            const inputPart3 = document.querySelector('input[name="socio_3_participacao"]');
            
            if (inputNome3) inputNome3.value = nome3;
            if (inputCpf3) inputCpf3.value = cpf3 || '';
            if (inputNasc3) inputNasc3.value = nasc3 || '';
            if (inputPart3) inputPart3.value = part3 || '';
            
            console.log(`✅ Preenchido sócio 3: ${nome3}`);
        }
    }, 200);
    
    // Preencher primeiro sócio (já existe)
    const nome1 = dadosCliente.socio_1_nome;
    if (nome1) {
        const inputNome1 = document.querySelector('input[name="socio_1_nome"]');
        const inputCpf1 = document.querySelector('input[name="socio_1_cpf"]');
        const inputNasc1 = document.querySelector('input[name="socio_1_data_nascimento"]');
        const inputPart1 = document.querySelector('input[name="socio_1_participacao"]');
        
        if (inputNome1) inputNome1.value = nome1;
        if (inputCpf1) inputCpf1.value = dadosCliente.socio_1_cpf || '';
        if (inputNasc1) inputNasc1.value = dadosCliente.socio_1_data_nascimento || '';
        if (inputPart1) inputPart1.value = dadosCliente.socio_1_participacao || '';
        
        console.log(`✅ Preenchido sócio 1: ${nome1}`);
    }
    
    console.log('✅ [CORREÇÃO 14] QUADRO SOCIETÁRIO CARREGADO - 3 SÓCIOS!');
    
    // CORREÇÃO 07: Reaplicar formatação CPF após carregar sócios
    setTimeout(function() {
        reaplicarFormatacaoCPF();
        console.log('🔧 [CORREÇÃO 07] Formatação CPF reaplicada após carregamento do quadro societário');
    }, 100);
}

function preencherFormularioSocio(numero, dadosSocio) {
    console.log(`📝 Preenchendo formulário sócio ${numero}:`, dadosSocio);
    
    // Preencher os campos
    const campos = {
        [`socio_${numero}_nome`]: dadosSocio.nome,
        [`socio_${numero}_cpf`]: dadosSocio.cpf,
        [`socio_${numero}_data_nascimento`]: dadosSocio.nascimento,
        [`socio_${numero}_participacao`]: dadosSocio.participacao
    };
    
    for (const [campo, valor] of Object.entries(campos)) {
        const input = document.querySelector(`input[name="${campo}"]`);
        if (input && valor) {
            input.value = valor;
            console.log(`✅ Preenchido ${campo}: ${valor}`);
        }
    }
    
    // Checkboxes
    const adminCheckbox = document.querySelector(`input[name="socio_${numero}_administrador"]`);
    if (adminCheckbox) {
        adminCheckbox.checked = dadosSocio.admin;
    }
    
    const respLegalCheckbox = document.querySelector(`input[name="socio_${numero}_resp_legal"]`);
    if (respLegalCheckbox) {
        respLegalCheckbox.checked = dadosSocio.respLegal;
    }
}

function criarCardSocio(numero, dadosSocio) {
    const container = document.getElementById('socios-container');
    
    const cardHtml = `
    <div class="card socio-card mb-3" id="socio_${numero}">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Sócio ${numero}</h6>
            <button type="button" class="btn btn-danger btn-sm" onclick="removerSocio(${numero})">
                <i class="fas fa-trash"></i> Remover
            </button>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Nome do Sócio ${numero}:</label>
                    <input type="text" class="form-control upper-input" name="socio_${numero}_nome" value="${dadosSocio.nome}">
                </div>
                <div class="col-md-6">
                    <label class="form-label">CPF do Sócio ${numero}:</label>
                    <input type="text" class="form-control" name="socio_${numero}_cpf" value="${dadosSocio.cpf}">
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-4">
                    <label class="form-label">Data de Nascimento:</label>
                    <input type="date" class="form-control" name="socio_${numero}_data_nascimento" value="${dadosSocio.nascimento}">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Participação (%):</label>
                    <input type="text" class="form-control" name="socio_${numero}_participacao" value="${dadosSocio.participacao}">
                </div>
                <div class="col-md-4">
                    <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" name="socio_${numero}_administrador" ${dadosSocio.admin ? 'checked' : ''}>
                        <label class="form-check-label">Administrador</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="socio_${numero}_resp_legal" ${dadosSocio.respLegal ? 'checked' : ''}>
                        <label class="form-check-label">Responsável Legal</label>
                    </div>
                </div>
            </div>
        </div>
    </div>`;
    
    container.insertAdjacentHTML('beforeend', cardHtml);
    console.log(`✅ Card do sócio ${numero} criado e inserido`);
}
    if (!dadosCliente) {
        console.log('❌ Dados do cliente não fornecidos');
function carregarContatos(dadosCliente) {
    console.log('� [CORREÇÃO 14] EXECUTANDO VERSÃO DEFINITIVA carregarContatos! 2025-08-24 08:30:00');
    console.log('🔧 [CORREÇÃO 14] EXECUTANDO VERSÃO DEFINITIVA carregarContatos! 2025-08-24 08:30:00');
    
    if (!dadosCliente) {
        console.log('❌ Dados do cliente não fornecidos');
        return;
    }
    
    const container = document.getElementById('contatos-container');
    if (!container) {
        console.log('❌ Container de contatos não encontrado');
        return;
    }
    
    // Identificar quantos contatos existem
    let contatosComDados = [];
    for (let i = 1; i <= 5; i++) {
        const nome = dadosCliente[`contato_${i}_nome`];
        if (nome && nome.trim() !== '') {
            contatosComDados.push({
                numero: i,
                nome: nome,
                cargo: dadosCliente[`contato_${i}_cargo`] || '',
                telefone: dadosCliente[`contato_${i}_telefone`] || '',
                email: dadosCliente[`contato_${i}_email`] || ''
            });
        }
    }
    
    console.log(`✅ Encontrados ${contatosComDados.length} contatos:`, contatosComDados);
    
    // Se só tem 1 contato, não precisamos criar cards adicionais
    if (contatosComDados.length <= 1) {
        console.log('ℹ️ Apenas 1 contato - preenchendo formulário principal');
        if (contatosComDados.length === 1) {
            const contato = contatosComDados[0];
            preencherFormularioContato(1, contato);
        }
        return;
    }
    
    // Para múltiplos contatos, criar cards adicionais
    console.log(`🔧 Criando ${contatosComDados.length - 1} cards de contatos adicionais...`);
    
    // Preencher primeiro contato (já existe no HTML)
    preencherFormularioContato(1, contatosComDados[0]);
    
    // Criar cards para contatos 2+
    for (let i = 1; i < contatosComDados.length; i++) {
        const contato = contatosComDados[i];
        const numeroCard = i + 1;
        
        console.log(`➕ Criando card para contato ${numeroCard}: ${contato.nome}`);
        
        // Criar o card diretamente
        criarCardContato(numeroCard, contato);
    }
    
    // Atualizar contador global
    numeroContatos = contatosComDados.length;
    console.log(`✅ Carregamento de contatos concluído! Total: ${numeroContatos}`);
}

function preencherFormularioContato(numero, dadosContato) {
    console.log(`📝 Preenchendo formulário contato ${numero}:`, dadosContato);
    
    // Preencher os campos
    const campos = {
        [`contato_${numero}_nome`]: dadosContato.nome,
        [`contato_${numero}_cargo`]: dadosContato.cargo,
        [`contato_${numero}_telefone`]: dadosContato.telefone,
        [`contato_${numero}_email`]: dadosContato.email
    };
    
    for (const [campo, valor] of Object.entries(campos)) {
        const input = document.querySelector(`input[name="${campo}"]`);
        if (input && valor) {
            input.value = valor;
            console.log(`✅ Preenchido ${campo}: ${valor}`);
        }
    }
}

function criarCardContato(numero, dadosContato) {
    const container = document.getElementById('contatos-container');
    
    const cardHtml = `
    <div class="card contato-card mb-3" id="contato_${numero}">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Contato ${numero}</h6>
            <button type="button" class="btn btn-danger btn-sm" onclick="removerContato(${numero})">
                <i class="fas fa-trash"></i> Remover
            </button>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Nome do Contato:</label>
                    <input type="text" class="form-control upper-input" name="contato_${numero}_nome" value="${dadosContato.nome}">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Cargo:</label>
                    <input type="text" class="form-control upper-input" name="contato_${numero}_cargo" value="${dadosContato.cargo}">
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-6">
                    <label class="form-label">Telefone:</label>
                    <input type="text" class="form-control" name="contato_${numero}_telefone" value="${dadosContato.telefone}">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Email:</label>
                    <input type="email" class="form-control" name="contato_${numero}_email" value="${dadosContato.email}">
                </div>
            </div>
        </div>
    </div>`;
    
    container.insertAdjacentHTML('beforeend', cardHtml);
    console.log(`✅ Card do contato ${numero} criado e inserido`);
}
    
    console.log('🔍 Total de propriedades no dadosCliente:', Object.keys(dadosCliente).length);
    
    // Debug específico: mostrar TODOS os campos de contatos que existem
    console.log('🔍 =====DEBUG CAMPOS CONTATOS=====');
    for (let i = 1; i <= 10; i++) {
        const nome = dadosCliente[`contato_${i}_nome`];
        const cargo = dadosCliente[`contato_${i}_cargo`];
        const telefone = dadosCliente[`contato_${i}_telefone`];
        const email = dadosCliente[`contato_${i}_email`];
        console.log(`Contato ${i}: nome='${nome}', cargo='${cargo}', tel='${telefone}', email='${email}'`);
    }
    console.log('🔍 =============================');
    
    // Primeiro, identificar quantos contatos existem
    let contatosEncontrados = [];
    for (let i = 1; i <= 10; i++) {
        const nome = dadosCliente[`contato_${i}_nome`];
        if (nome && nome.trim() !== '') {
            contatosEncontrados.push(i);
            console.log(`✅ Contato ${i} encontrado: ${nome}`);
        }
    }
    
    console.log(`🔍 Total de contatos encontrados: ${contatosEncontrados.length}`);
    console.log(`🔍 Lista de contatos: [${contatosEncontrados.join(', ')}]`);
    
    // VERIFICAÇÃO CRÍTICA: Verificar se contatosContainer existe
    const contatosContainer = document.getElementById('contatosContainer');
    console.log('🔍 VERIFICAÇÃO CRÍTICA: contatosContainer existe?', !!contatosContainer);
    
    if (!contatosContainer) {
        console.error('❌ ERRO CRÍTICO: contatosContainer NÃO existe! O JavaScript não pode adicionar contatos.');
        console.log('🔍 Elementos com ID que contém "contato":', 
            Array.from(document.querySelectorAll('[id*="contato"]')).map(el => el.id));
        return; // Para a execução se não encontrar o container
    }
    
    // Adicionar cards para todos os contatos que não seja o primeiro (que já existe no HTML)
    console.log('🔧 INICIANDO CRIAÇÃO DE CARDS DE CONTATOS...');
    contatosEncontrados.forEach(numeroContato => {
        if (numeroContato > 1) {
            console.log(`➕ Adicionando card para contato ${numeroContato}...`);
            
            // Verificar se o card já existe
            const cardExiste = document.getElementById(`contato_${numeroContato}`);
            console.log(`🔍 Card do contato ${numeroContato} existe? ${!!cardExiste}`);
            
            if (!cardExiste) {
                console.log(`📝 Chamando adicionarContato() para criar card ${numeroContato}...`);
                console.log(`🔧 Estado ANTES da chamada - numeroContatos: ${numeroContatos}`);
                adicionarContato(); // Adicionar card de contato
                console.log(`🔧 Estado DEPOIS da chamada - numeroContatos: ${numeroContatos}`);
                
                // PROBLEMA: adicionarContato() incrementa numeroContatos, mas pode não estar alinhado
                // com o numeroContato que precisamos. Vamos forçar o alinhamento:
                if (numeroContatos !== numeroContato) {
                    console.log(`⚠️ CORREÇÃO: numeroContatos (${numeroContatos}) != numeroContato esperado (${numeroContato})`);
                    
                    // Renomear o card criado para o número correto
                    const cardCriado = document.getElementById(`contato_${numeroContatos}`);
                    if (cardCriado) {
                        cardCriado.id = `contato_${numeroContato}`;
                        
                        // Renomear todos os campos dentro do card
                        const inputs = cardCriado.querySelectorAll('input');
                        inputs.forEach(input => {
                            if (input.name) {
                                input.name = input.name.replace(`_${numeroContatos}_`, `_${numeroContato}_`);
                            }
                            if (input.id) {
                                input.id = input.id.replace(`_${numeroContatos}`, `_${numeroContato}`);
                            }
                        });
                        
                        // Corrigir botão de remoção
                        const btnRemover = cardCriado.querySelector('button[onclick*="removerContato"]');
                        if (btnRemover) {
                            btnRemover.onclick = () => removerContato(numeroContato);
                        }
                        
                        console.log(`✅ Card renomeado de contato_${numeroContatos} para contato_${numeroContato}`);
                    }
                }
                
                console.log(`✅ Card adicionado para contato ${numeroContato}`);
            } else {
                console.log(`ℹ️ Card do contato ${numeroContato} já existe`);
            }
        }
    });
    
    // Aguardar um momento para que os elementos sejam criados no DOM
    console.log('⏳ Aguardando criação dos elementos de contatos no DOM...');
    setTimeout(() => {
        console.log('🔍 Preenchendo dados dos contatos...');
        
        // Verificar estado do DOM após timeout
        console.log('🔍 Estado do DOM após timeout:');
        for (let i = 1; i <= 10; i++) {
            const card = document.getElementById(`contato_${i}`);
            console.log(`   Card contato ${i}: ${!!card ? 'EXISTE' : 'NÃO EXISTE'}`);
        }
        
        // Preencher os campos de todos os contatos
        contatosEncontrados.forEach(numeroContato => {
            const nome = dadosCliente[`contato_${numeroContato}_nome`];
            console.log(`🔍 Preenchendo contato ${numeroContato}: ${nome}`);
            
            // Preencher os campos
            const nomeInput = document.getElementById(`contato_${numeroContato}_nome`);
            const cargoInput = document.getElementById(`contato_${numeroContato}_cargo`);
            const telefoneInput = document.getElementById(`contato_${numeroContato}_telefone`);
            const emailInput = document.getElementById(`contato_${numeroContato}_email`);
            
            console.log(`🔍 Elementos encontrados para contato ${numeroContato}:`, {
                nome: !!nomeInput,
                cargo: !!cargoInput,
                telefone: !!telefoneInput,
                email: !!emailInput
            });
            
            if (nomeInput) nomeInput.value = nome || '';
            if (cargoInput) cargoInput.value = dadosCliente[`contato_${numeroContato}_cargo`] || '';
            if (telefoneInput) telefoneInput.value = dadosCliente[`contato_${numeroContato}_telefone`] || '';
            if (emailInput) emailInput.value = dadosCliente[`contato_${numeroContato}_email`] || '';
            
            console.log(`✅ Contato ${numeroContato} preenchido com sucesso`);
        });
        
        console.log('✅ CARREGAR CONTATOS FINALIZADO');
    }, 500); // Delay aumentado para garantir que os elementos foram criados
}

// Função para confirmar exclusão
function confirmDelete(clientId, clientName) {
    document.getElementById('clientName').textContent = clientName;
    var deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
    deleteModal.show();
}

// Funções para gerenciar contatos
function adicionarContato() {
    console.log(`🔧 [CORREÇÃO 09] CONTATOS: Iniciando... numeroContatos atual: ${numeroContatos}`);
    
    // CORREÇÃO 09: Primeiro verificar se há contatos estáticos ocultos (2-5)
    var contatosEstaticosOcultos = [];
    for (var i = 2; i <= 5; i++) {
        var contatoEstatico = document.getElementById('contato_' + i);
        if (contatoEstatico && contatoEstatico.style.display === 'none') {
            contatosEstaticosOcultos.push(i);
        }
    }
    
    if (contatosEstaticosOcultos.length > 0) {
        // Mostrar o primeiro contato oculto
        var proximoContato = contatosEstaticosOcultos[0];
        var contatoElement = document.getElementById('contato_' + proximoContato);
        contatoElement.style.display = 'block';
        console.log('✅ [CORREÇÃO 09] Contato', proximoContato, 'revelado (estava oculto)');
        
        // Aplicar máscara telefone ao contato revelado
        var phoneInput = contatoElement.querySelector('.phone-mask');
        if (phoneInput) {
            if (phoneInput.value && phoneInput.value.length > 0) {
                formatPhone(phoneInput);
                console.log('🔧 [CORREÇÃO 09] Telefone formatado no contato revelado:', phoneInput.value);
            }
        }
        
        // Focar no primeiro campo do contato revelado
        var firstInput = contatoElement.querySelector('input');
        if (firstInput) firstInput.focus();
        
        return; // Sair da função - não criar contato dinâmico
    }
    
    // Se chegou aqui, todos os contatos estáticos (2-5) já estão visíveis
    // Proceder com criação de contato dinâmico (6+)
    console.log('🔧 [CORREÇÃO 09] Todos contatos estáticos visíveis - criando dinâmico');
    
    // VERIFICAÇÃO CRÍTICA: Container existe?
    const container = document.getElementById('contatosContainer');
    if (!container) {
        console.error('❌ ERRO CRÍTICO: contatosContainer não encontrado na função adicionarContato!');
        return false; // Para a função
    }
    
    numeroContatos++;
    console.log(`🔧 [CORREÇÃO 09] CONTATOS: Incrementado para: ${numeroContatos}`);
    console.log(`🔧 [CORREÇÃO 09] CONTATOS: Container encontrado:`, !!container);
    
    try {
        const novoContato = document.createElement('div');
        novoContato.className = 'card border-light mb-2 contato-card';
        novoContato.id = `contato_${numeroContatos}`;
        console.log(`🔧 [CORREÇÃO 09] CONTATOS: Criando card dinâmico com ID: contato_${numeroContatos}`);
    
    // Reutilizar a mesma variável novoContato
    novoContato.innerHTML = `
        <div class="card-body py-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="badge bg-secondary">Contato ${numeroContatos}</span>
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removerContato(${numeroContatos})" title="Remover contato">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="row align-items-center">
                <div class="col-md-3 mb-2">
                    <label class="form-label small mb-1">Nome</label>
                    <input type="text" class="form-control form-control-sm" 
                           name="contato_${numeroContatos}_nome" id="contato_${numeroContatos}_nome"
                           placeholder="Nome completo do contato">
                </div>
                <div class="col-md-3 mb-2">
                    <label class="form-label small mb-1">Cargo</label>
                    <input type="text" class="form-control form-control-sm" 
                           name="contato_${numeroContatos}_cargo" id="contato_${numeroContatos}_cargo"
                           placeholder="Ex: Gerente, Diretor, Sócio">
                </div>
                <div class="col-md-3 mb-2">
                    <label class="form-label small mb-1">Telefone</label>
                    <input type="tel" class="form-control form-control-sm phone-mask" 
                           name="contato_${numeroContatos}_telefone" id="contato_${numeroContatos}_telefone"
                           placeholder="(85) 99999-9999">
                </div>
                <div class="col-md-3 mb-2">
                    <label class="form-label small mb-1">E-mail</label>
                    <input type="email" class="form-control form-control-sm" 
                           name="contato_${numeroContatos}_email" id="contato_${numeroContatos}_email"
                           placeholder="contato@empresa.com">
                </div>
            </div>
        </div>
    `;
    
    container.appendChild(novoContato);
    
    // Aplicar máscara ao novo campo de telefone
    const phoneInput = novoContato.querySelector('.phone-mask');
    if (phoneInput) {
        phoneInput.addEventListener('input', function() {
            formatPhone(this);
        });
    }
    
    console.log(`✅ [CORREÇÃO 09] CONTATOS: Card dinâmico contato_${numeroContatos} criado e adicionado ao DOM`);
    
    // Verificar se o elemento foi realmente adicionado
    setTimeout(() => {
        const verificar = document.getElementById(`contato_${numeroContatos}`);
        console.log(`🔍 [CORREÇÃO 09] CONTATOS: Verificação após 100ms - Card existe? ${!!verificar}`);
    }, 100);
    
    } catch (error) {
        console.error('❌ ERRO na função adicionarContato:', error);
        return false;
    }
}

function removerContato(numero) {
    // Não permitir remover o primeiro contato
    if (numero === 1) {
        alert('O primeiro contato não pode ser removido!');
        return;
    }
    
    const card = document.getElementById(`contato_${numero}`);
    if (card) {
        card.remove();
    }
}

// Função para controlar habilitação/desabilitação dos campos de procuração
function toggleProcuracaoData(checkboxId, dataInputId) {
    console.log('🔄 toggleProcuracaoData chamada:', checkboxId, dataInputId);
    
    const checkbox = document.getElementById(checkboxId);
    const dataInput = document.getElementById(dataInputId);
    
    console.log('📦 Elementos encontrados:', {
        checkbox: checkbox ? 'SIM' : 'NÃO',
        dataInput: dataInput ? 'SIM' : 'NÃO',
        checkboxChecked: checkbox ? checkbox.checked : 'N/A'
    });
    
    if (checkbox && dataInput) {
        if (checkbox.checked) {
            dataInput.disabled = false;
            dataInput.focus();
            console.log('✅ Campo habilitado:', dataInputId);
        } else {
            dataInput.disabled = true;
            dataInput.value = '';
            console.log('❌ Campo desabilitado:', dataInputId);
        }
    } else {
        console.error('⚠️ Elementos não encontrados!', {checkboxId, dataInputId});
    }
}

// Função para inicializar o estado dos campos de procuração
function inicializarProcuracoes() {
    console.log('🚀 Inicializando procurações...');
    
    const procuracoes = [
        ['procReceita', 'dataProcReceita'],
        ['procDte', 'dataProcDte'],
        ['procCaixa', 'dataProcCaixa'],
        ['procEmpWeb', 'dataProcEmpWeb'],
        ['procDet', 'dataProcDet']
    ];
    
    procuracoes.forEach(function([checkboxId, dataInputId]) {
        const checkbox = document.getElementById(checkboxId);
        const dataInput = document.getElementById(dataInputId);
        
        console.log(`🔍 Verificando ${checkboxId}:`, {
            checkbox: checkbox ? 'ENCONTRADO' : 'NÃO ENCONTRADO',
            dataInput: dataInput ? 'ENCONTRADO' : 'NÃO ENCONTRADO',
            checked: checkbox ? checkbox.checked : 'N/A'
        });
        
        if (checkbox && dataInput) {
            // Definir estado inicial baseado no checkbox
            dataInput.disabled = !checkbox.checked;
            console.log(`✅ ${dataInputId} inicializado - disabled: ${dataInput.disabled}`);
        } else {
            console.error(`❌ Erro ao encontrar elementos para ${checkboxId}/${dataInputId}`);
        }
    });
    
    console.log('✅ Inicialização de procurações concluída');
}

// Função para inicializar todas as validações de campos
function inicializarValidacaoCampos() {
    console.log('🔧 Inicializando validações de campos...');
    
    const cpfCnpjInput = document.getElementById('cpfCnpj');
    const conditionalFields = document.querySelectorAll('.conditional-required');
    
    function updateRequiredFields() {
    const value = cpfCnpjInput.value.replace(/\D/g, '');
    const isCPF = value.length === 11;
    const isCNPJ = value.length === 14;
        
        console.log('🔄 Atualizando campos obrigatórios:', {
            value: value,
            length: value.length,
            isCPF: isCPF
        });
        
        // Se for CPF (11 dígitos), só obrigar: Nome da Empresa, CPF, Estado, Cidade
        if (isCPF) {
            // Ocultar asteriscos condicionais
            conditionalFields.forEach(span => {
                span.style.display = 'none';
            });
            
            // Remover required dos campos condicionais
            ['razaoSocialReceita', 'nomeFantasiaReceita', 'inscEst', 'inscMun', 
             'segmento', 'atividade', 'regimeEstadual', 'regimeFederal'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.removeAttribute('required');
            });
            
            console.log('👤 Modo CPF: campos opcionais configurados');
        } else if (isCNPJ) {
            // Se for CNPJ (14 dígitos), todos os campos são obrigatórios
            conditionalFields.forEach(span => {
                span.style.display = 'inline';
            });
            
            // Adicionar required aos campos condicionais
            ['razaoSocialReceita', 'nomeFantasiaReceita', 'inscEst', 'inscMun', 
             'segmento', 'atividade', 'regimeEstadual', 'regimeFederal'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.setAttribute('required', 'required');
            });
            
            console.log('🏢 Modo CNPJ: todos os campos obrigatórios');
        } else {
            // Incompleto: manter sem obrigatoriedade extra e ocultar asteriscos
            conditionalFields.forEach(span => {
                span.style.display = 'none';
            });
            ['razaoSocialReceita', 'nomeFantasiaReceita', 'inscEst', 'inscMun', 
             'segmento', 'atividade', 'regimeEstadual', 'regimeFederal'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.removeAttribute('required');
            });
            console.log('⏳ CPF/CNPJ incompleto: requisitos condicionais desativados');
        }
    }
    
    // Executar ao carregar a página
    if (cpfCnpjInput) {
        updateRequiredFields();
        
        // Adicionar evento para atualizar quando CPF/CNPJ mudar
        cpfCnpjInput.addEventListener('input', updateRequiredFields);
        console.log('✅ Event listener do CPF/CNPJ adicionado');
    } else {
        console.error('❌ Campo CPF/CNPJ não encontrado!');
    }
}

// Função para validar formulário antes do submit
function validarFormulario(form) {
    console.log('🔍 Validando formulário...');
    
    const cpfCnpjInput = document.getElementById('cpfCnpj');
    const nomeEmpresaInput = document.getElementById('nomeEmpresa');
    const estadoSelect = document.getElementById('estado');
    const cidadeSelect = document.getElementById('cidade');
    
    let erros = [];
    
    // Validar Nome da Empresa (sempre obrigatório)
    if (!nomeEmpresaInput.value.trim()) {
        erros.push('Nome da Empresa é obrigatório');
        nomeEmpresaInput.classList.add('is-invalid');
        nomeEmpresaInput.classList.remove('is-valid');
    } else {
        nomeEmpresaInput.classList.remove('is-invalid');
        nomeEmpresaInput.classList.add('is-valid');
    }
    
    // Validar CPF/CNPJ (sempre obrigatório)
    const cpfCnpjValue = cpfCnpjInput.value.replace(/\D/g, '');
    if (!cpfCnpjValue || (cpfCnpjValue.length !== 11 && cpfCnpjValue.length !== 14)) {
        erros.push('CPF/CNPJ é obrigatório e deve estar completo');
        cpfCnpjInput.classList.add('is-invalid');
        cpfCnpjInput.classList.remove('is-valid');
    } else {
        cpfCnpjInput.classList.remove('is-invalid');
        cpfCnpjInput.classList.add('is-valid');
    }
    
    // Validar Estado (sempre obrigatório)
    if (!estadoSelect.value) {
        erros.push('Estado é obrigatório');
        estadoSelect.classList.add('is-invalid');
        estadoSelect.classList.remove('is-valid');
    } else {
        estadoSelect.classList.remove('is-invalid');
        estadoSelect.classList.add('is-valid');
    }
    
    // Validar Cidade (sempre obrigatório)
    if (!cidadeSelect.value) {
        erros.push('Cidade é obrigatória');
        cidadeSelect.classList.add('is-invalid');
        cidadeSelect.classList.remove('is-valid');
    } else {
        cidadeSelect.classList.remove('is-invalid');
        cidadeSelect.classList.add('is-valid');
    }
    
    // Validações condicionais para CNPJ
    const isCNPJ = cpfCnpjValue.length === 14;
    if (isCNPJ) {
        const camposObrigatoriosCNPJ = [
            {id: 'razaoSocialReceita', nome: 'Razão Social'},
            {id: 'nomeFantasiaReceita', nome: 'Nome Fantasia'},
            {id: 'inscEst', nome: 'Inscrição Estadual'},
            {id: 'inscMun', nome: 'Inscrição Municipal'},
            {id: 'segmento', nome: 'Segmento'},
            {id: 'atividade', nome: 'Atividade'},
            {id: 'regimeEstadual', nome: 'Regime Estadual'},
            {id: 'regimeFederal', nome: 'Regime Federal'}
        ];
        
        camposObrigatoriosCNPJ.forEach(campo => {
            const input = document.getElementById(campo.id);
            if (input && !input.value.trim()) {
                erros.push(`${campo.nome} é obrigatório para CNPJ`);
                input.classList.add('is-invalid');
            } else if (input) {
                input.classList.remove('is-invalid');
            }
        });
    }
    
    if (erros.length > 0) {
        console.error('❌ Erros de validação:', erros);
        
        // Mostrar alerta com os erros
        const mensagem = 'Por favor, corrija os seguintes erros:\n\n' + erros.join('\n');
        alert(mensagem);
        
        // Rolar para o primeiro campo com erro
        const primeiroErro = form.querySelector('.is-invalid');
        if (primeiroErro) {
            primeiroErro.scrollIntoView({ behavior: 'smooth', block: 'center' });
            primeiroErro.focus();
        }
        
        return false;
    }
    
    console.log('✅ Formulário validado com sucesso');
    return true;
}

// Função para alternar a visibilidade das senhas
function togglePasswordVisibility(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        button.title = 'Ocultar senha';
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        button.title = 'Mostrar senha';
    }
}

// === NOVOS SCRIPTS PARA LAYOUT E REGRAS ===

// CSS para caixa alta
const style = document.createElement('style');
style.textContent = `
    .upper-input { 
        text-transform: uppercase; 
        background-color: #f8f9fa;
        border: 1px solid #28a745;
    }
    .upper-input:focus { 
        background-color: #ffffff;
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }
    .conditional-required { display: none; }
`;
document.head.appendChild(style);

// === FUNÇÃO PARA MAIÚSCULAS OBRIGATÓRIAS ===
function setupUppercaseFields() {
    // Lista de campos que devem ficar sempre em maiúsculas
    const uppercaseFields = [
        'sistemaUtilizado'   // Sistema Utilizado
    ];
    
    // Configurar campos de input de texto
    uppercaseFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            // Adicionar classe CSS para maiúsculas
            field.classList.add('upper-input');
            
            // Event listener para converter em tempo real
            field.addEventListener('input', function(e) {
                const cursorPos = e.target.selectionStart;
                e.target.value = e.target.value.toUpperCase();
                e.target.setSelectionRange(cursorPos, cursorPos);
            });
        }
    });
    
    // Configurar campos select para maiúsculas obrigatórias
    const selectFields = ['estado', 'regimeEstadual', 'regimeFederal'];
    selectFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            // Adicionar classe CSS para maiúsculas
            field.classList.add('upper-input');
            
            // Event listener para converter em tempo real (select options já vêm em maiúsculas do HTML)
            field.addEventListener('change', function(e) {
                // Para selects, o value já vem correto do HTML, mas garantimos maiúscula
                if (e.target.value) {
                    e.target.value = e.target.value.toUpperCase();
                }
            });
        }
    });
}

// === FUNÇÃO PARA NOMES DE SÓCIOS DINÂMICOS ===
function setupSocioUppercase(socioNumber) {
    const nomeField = document.getElementById(`socio_${socioNumber}_nome`);
    if (nomeField) {
        nomeField.classList.add('upper-input');
        
        nomeField.addEventListener('input', function(e) {
            const cursorPos = e.target.selectionStart;
            e.target.value = e.target.value.toUpperCase();
            e.target.setSelectionRange(cursorPos, cursorPos);
        });
        
        // Também forçar maiúscula ao sair do campo
        nomeField.addEventListener('blur', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
    }
}

// Executar configuração quando página carregar
document.addEventListener('DOMContentLoaded', function() {
    setupUppercaseFields();
    
    // Configurar campos existentes de sócios (1-10)
    for (let i = 1; i <= 10; i++) {
        setupSocioUppercase(i);
    }
});

// Observador para novos sócios adicionados dinamicamente
const sociosContainer = document.getElementById('sociosContainer');
if (sociosContainer) {
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === Node.ELEMENT_NODE) {
                    // Procurar por campos de nome de sócio no novo elemento
                    const nomeInputs = node.querySelectorAll('input[name*="_nome"]');
                    nomeInputs.forEach(input => {
                        input.classList.add('upper-input');
                        input.addEventListener('input', function(e) {
                            const cursorPos = e.target.selectionStart;
                            e.target.value = e.target.value.toUpperCase();
                            e.target.setSelectionRange(cursorPos, cursorPos);
                        });
                    });
                }
            });
        });
    });
    
    observer.observe(sociosContainer, {
        childList: true,
        subtree: true
    });
}

// CORREÇÃO 14: NOVA FUNÇÃO SIMPLES PARA CONTATOS - SEM ALERTAS BLOQUEANTES
function carregarContatosSimples(dadosCliente) {
    console.log('🔧 [CORREÇÃO 14] CARREGANDO CONTATOS - VERSÃO SIMPLES (SEM ALERTAS)');
    
    if (!dadosCliente) {
        console.error('❌ ERRO: Dados do cliente não fornecidos');
        return;
    }
    
    // FORÇAR criação imediata dos cards
    setTimeout(() => {
        // Card 2
        if (dadosCliente.contato_2_nome) {
            adicionarContato();
            setTimeout(() => {
                const nome2 = document.querySelector('input[name="contato_2_nome"]');
                const cargo2 = document.querySelector('input[name="contato_2_cargo"]');
                const tel2 = document.querySelector('input[name="contato_2_telefone"]');
                const email2 = document.querySelector('input[name="contato_2_email"]');
                
                if (nome2) nome2.value = dadosCliente.contato_2_nome;
                if (cargo2) cargo2.value = dadosCliente.contato_2_cargo || '';
                if (tel2) tel2.value = dadosCliente.contato_2_telefone || '';
                if (email2) email2.value = dadosCliente.contato_2_email || '';
                
                console.log(`✅ Contato 2 preenchido: ${dadosCliente.contato_2_nome}`);
            }, 100);
        }
        
        // Card 3
        if (dadosCliente.contato_3_nome) {
            setTimeout(() => {
                adicionarContato();
                setTimeout(() => {
                    const nome3 = document.querySelector('input[name="contato_3_nome"]');
                    const cargo3 = document.querySelector('input[name="contato_3_cargo"]');
                    const tel3 = document.querySelector('input[name="contato_3_telefone"]');
                    const email3 = document.querySelector('input[name="contato_3_email"]');
                    
                    if (nome3) nome3.value = dadosCliente.contato_3_nome;
                    if (cargo3) cargo3.value = dadosCliente.contato_3_cargo || '';
                    if (tel3) tel3.value = dadosCliente.contato_3_telefone || '';
                    if (email3) email3.value = dadosCliente.contato_3_email || '';
                    
                    console.log(`✅ Contato 3 preenchido: ${dadosCliente.contato_3_nome}`);
                }, 100);
            }, 200);
        }
    }, 500);
    
    // Preencher primeiro contato (já existe)
    const nome1 = document.querySelector('input[name="contato_1_nome"]');
    const cargo1 = document.querySelector('input[name="contato_1_cargo"]');
    const tel1 = document.querySelector('input[name="contato_1_telefone"]');
    const email1 = document.querySelector('input[name="contato_1_email"]');
    
    if (nome1 && dadosCliente.contato_1_nome) {
        nome1.value = dadosCliente.contato_1_nome;
        if (cargo1) cargo1.value = dadosCliente.contato_1_cargo || '';
        if (tel1) tel1.value = dadosCliente.contato_1_telefone || '';
        if (email1) email1.value = dadosCliente.contato_1_email || '';
        console.log(`✅ Contato 1 preenchido: ${dadosCliente.contato_1_nome}`);
    }
    
    console.log('✅ [CORREÇÃO 14] CONTATOS SIMPLES CARREGADOS!');
}

// Sobrescrever a função problemática
window.carregarContatos = carregarContatosSimples;

// NOVA FUNÇÃO PARA SÓCIOS - FORÇA BRUTA
function carregarSociosForcaBruta(dadosCliente) {
    console.log('� [CORREÇÃO 14] FORÇA BRUTA - SEMPRE 3 SÓCIOS!');
    console.log('⚡ Executando força bruta para sócios');
    
    // SEMPRE criar 2 sócios adicionais (total = 3)
    console.log('🔧 Criando sócio 2...');
    setTimeout(() => {
        adicionarSocio();
        console.log('✅ Sócio 2 adicionado');
        
        // Preencher sócio 2 se tiver dados
        setTimeout(() => {
            const input2 = document.querySelector('input[name="socio_2_nome"]');
            if (input2) {
                if (dadosCliente && dadosCliente.socio_2_nome) {
                    input2.value = dadosCliente.socio_2_nome;
                    console.log('✅ Sócio 2 preenchido com dados reais');
                } else {
                    input2.value = 'SÓCIO 2 - TESTE';
                    console.log('⚠️ Sócio 2 preenchido com dados de teste');
                }
            }
        }, 200);
    }, 100);
    
    console.log('🔧 Criando sócio 3...');
    setTimeout(() => {
        adicionarSocio();
        console.log('✅ Sócio 3 adicionado');
        
        // Preencher sócio 3 se tiver dados
        setTimeout(() => {
            const input3 = document.querySelector('input[name="socio_3_nome"]');
            if (input3) {
                if (dadosCliente && dadosCliente.socio_3_nome) {
                    input3.value = dadosCliente.socio_3_nome;
                    console.log('✅ Sócio 3 preenchido com dados reais');
                } else {
                    input3.value = 'SÓCIO 3 - TESTE';
                    console.log('⚠️ Sócio 3 preenchido com dados de teste');
                }
            }
        }, 200);
    }, 300);
    
    // Preencher sócio 1 (já existe)
    setTimeout(() => {
        const input1 = document.querySelector('input[name="socio_1_nome"]');
        if (input1) {
            if (dadosCliente && dadosCliente.socio_1_nome) {
                input1.value = dadosCliente.socio_1_nome;
                console.log('✅ Sócio 1 preenchido com dados reais');
            } else {
                input1.value = 'SÓCIO 1 - TESTE';
                console.log('⚠️ Sócio 1 preenchido com dados de teste');
            }
        }
    }, 50);
    
    // Verificação final
    setTimeout(() => {
        const cards = document.querySelectorAll('.socio-card, [id*="socio"], .card:has(input[name*="socio"])');
        alert(`🎯 CRIADOS: ${cards.length} cards de sócios!`);
        console.log(`🏁 Resultado final: ${cards.length} cards encontrados`);
    }, 1000);
}

// SOLUÇÃO SIMPLES E FINAL
window.carregarSocios = function(dadosCliente) {
    console.log('🔧 SOLUÇÃO SIMPLES - Carregando sócios...');
    
    if (!dadosCliente) return;
    
    // Usar a função original adicionarSocio que já funciona
    setTimeout(() => {
        // Se tem sócio 2, adicionar card
        if (dadosCliente.socio_2_nome) {
            adicionarSocio();
            setTimeout(() => {
                const nome2 = document.querySelector('input[name="socio_2_nome"]');
                if (nome2) nome2.value = dadosCliente.socio_2_nome;
                
                const cpf2 = document.querySelector('input[name="socio_2_cpf"]');
                if (cpf2) cpf2.value = dadosCliente.socio_2_cpf || '';
            }, 200);
        }
        
        // Se tem sócio 3, adicionar card
        if (dadosCliente.socio_3_nome) {
            setTimeout(() => {
                adicionarSocio();
                setTimeout(() => {
                    const nome3 = document.querySelector('input[name="socio_3_nome"]');
                    if (nome3) nome3.value = dadosCliente.socio_3_nome;
                    
                    const cpf3 = document.querySelector('input[name="socio_3_cpf"]');
                    if (cpf3) cpf3.value = dadosCliente.socio_3_cpf || '';
                }, 200);
            }, 400);
        }
        
        // Preencher sócio 1
        const nome1 = document.querySelector('input[name="socio_1_nome"]');
        if (nome1) nome1.value = dadosCliente.socio_1_nome || '';
        
        const cpf1 = document.querySelector('input[name="socio_1_cpf"]');
        if (cpf1) cpf1.value = dadosCliente.socio_1_cpf || '';
    }, 100);
};

// Função final para carregar sócios
function carregarSocios(dadosCliente) {
    console.log('� SOLUÇÃO DEFINITIVA - Carregando sócios...');
    
    if (!dadosCliente) return;
    
    // Aguardar DOM estar pronto
    setTimeout(() => {
        const container = document.getElementById('socios-container');
        if (!container) {
            console.error('❌ Container socios-container não encontrado');
            return;
        }
        
        // Criar HTML completo para 3 sócios (incluindo o primeiro)
        const htmlCompleto = `
        <!-- Sócio 1 -->
        <div class="card socio-card mb-3" id="socio_1">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">Sócio 1</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Nome do Sócio:</label>
                        <input type="text" class="form-control upper-input" name="socio_1_nome" value="${dadosCliente.socio_1_nome || ''}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">CPF:</label>
                        <input type="text" class="form-control" name="socio_1_cpf" value="${dadosCliente.socio_1_cpf || ''}">
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-4">
                        <label class="form-label">Data de Nascimento:</label>
                        <input type="date" class="form-control" name="socio_1_data_nascimento" value="${dadosCliente.socio_1_data_nascimento || ''}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Participação (%):</label>
                        <input type="number" class="form-control" name="socio_1_participacao" step="0.01" value="${dadosCliente.socio_1_participacao || ''}">
                    </div>
                    <div class="col-md-4">
                        <div class="form-check mt-4">
                            <input class="form-check-input" type="checkbox" name="socio_1_administrador" ${dadosCliente.socio_1_administrador ? 'checked' : ''}>
                            <label class="form-check-label">Administrador</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="socio_1_resp_legal" ${dadosCliente.socio_1_resp_legal ? 'checked' : ''}>
                            <label class="form-check-label">Resp. Legal</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sócio 2 -->
        <div class="card socio-card mb-3" id="socio_2" ${!dadosCliente.socio_2_nome ? 'style="display:none;"' : ''}>
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">Sócio 2</h6>
                <button type="button" class="btn btn-danger btn-sm" onclick="document.getElementById('socio_2').style.display='none'">
                    <i class="fas fa-trash"></i> Remover
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Nome do Sócio:</label>
                        <input type="text" class="form-control upper-input" name="socio_2_nome" value="${dadosCliente.socio_2_nome || ''}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">CPF:</label>
                        <input type="text" class="form-control" name="socio_2_cpf" value="${dadosCliente.socio_2_cpf || ''}">
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-4">
                        <label class="form-label">Data de Nascimento:</label>
                        <input type="date" class="form-control" name="socio_2_data_nascimento" value="${dadosCliente.socio_2_data_nascimento || ''}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Participação (%):</label>
                        <input type="number" class="form-control" name="socio_2_participacao" step="0.01" value="${dadosCliente.socio_2_participacao || ''}">
                    </div>
                    <div class="col-md-4">
                        <div class="form-check mt-4">
                            <input class="form-check-input" type="checkbox" name="socio_2_administrador" ${dadosCliente.socio_2_administrador ? 'checked' : ''}>
                            <label class="form-check-label">Administrador</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="socio_2_resp_legal" ${dadosCliente.socio_2_resp_legal ? 'checked' : ''}>
                            <label class="form-check-label">Resp. Legal</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sócio 3 -->
        <div class="card socio-card mb-3" id="socio_3" ${!dadosCliente.socio_3_nome ? 'style="display:none;"' : ''}>
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">Sócio 3</h6>
                <button type="button" class="btn btn-danger btn-sm" onclick="document.getElementById('socio_3').style.display='none'">
                    <i class="fas fa-trash"></i> Remover
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Nome do Sócio:</label>
                        <input type="text" class="form-control upper-input" name="socio_3_nome" value="${dadosCliente.socio_3_nome || ''}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">CPF:</label>
                        <input type="text" class="form-control" name="socio_3_cpf" value="${dadosCliente.socio_3_cpf || ''}">
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-4">
                        <label class="form-label">Data de Nascimento:</label>
                        <input type="date" class="form-control" name="socio_3_data_nascimento" value="${dadosCliente.socio_3_data_nascimento || ''}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Participação (%):</label>
                        <input type="number" class="form-control" name="socio_3_participacao" step="0.01" value="${dadosCliente.socio_3_participacao || ''}">
                    </div>
                    <div class="col-md-4">
                        <div class="form-check mt-4">
                            <input class="form-check-input" type="checkbox" name="socio_3_administrador" ${dadosCliente.socio_3_administrador ? 'checked' : ''}>
                            <label class="form-check-label">Administrador</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="socio_3_resp_legal" ${dadosCliente.socio_3_resp_legal ? 'checked' : ''}>
                            <label class="form-check-label">Resp. Legal</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;
        
        // Substituir todo o conteúdo do container
        container.innerHTML = htmlCompleto;
        
        console.log('✅ Sócios carregados com HTML completo');
        
        // Mostrar cards que têm dados
        if (dadosCliente.socio_2_nome) {
            document.getElementById('socio_2').style.display = 'block';
        }
        if (dadosCliente.socio_3_nome) {
            document.getElementById('socio_3').style.display = 'block';
        }
        
    }, 100);
}

// Função simples para mostrar sócios ocultos
function mostrarSocio(numero) {
    const socio = document.getElementById(`socio_${numero}`);
    if (socio) {
        socio.style.display = 'block';
    }
}

// Substituir as funções problemáticas
window.carregarSocios = carregarSocios;
window.adicionarSocio = () => {
    // Mostrar sócio 2 se estiver oculto
    const socio2 = document.getElementById('socio_2');
    const socio3 = document.getElementById('socio_3');
    
    if (socio2 && socio2.style.display === 'none') {
        socio2.style.display = 'block';
        return;
    }
    
    if (socio3 && socio3.style.display === 'none') {
        socio3.style.display = 'block';
        return;
    }
    
    alert('Máximo de 3 sócios permitidos');
};

</script>

        </div>
    </div>

    <!-- Rodapé Simples -->
    <footer class="mt-5" style="background: #6c757d; color: white; padding: 1rem 0;">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <small>© 2024 Sistema de Gestão. Todos os direitos reservados.</small>
                </div>
                <div class="col-md-6 text-end">
                    <small>Sistema de Gestão v2.0</small>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-dismiss alerts após 3 segundos
            function autoDismissAlerts() {
                setTimeout(function() {
                    var alerts = document.querySelectorAll('.alert');
                    alerts.forEach(function(alert) {
                        if (alert.classList.contains('show')) {
                            var bsAlert = new bootstrap.Alert(alert);
                            bsAlert.close();
                        }
                    });
                }, 3000);
            }
            
            // Configuração específica para o dropdown do usuário
            var userDropdown = document.getElementById('userDropdown');
            if (userDropdown) {
                // Esconde alertas quando dropdown do usuário é aberto
                userDropdown.addEventListener('click', function() {
                    var alerts = document.querySelectorAll('.alert');
                    alerts.forEach(function(alert) {
                        if (alert.classList.contains('show')) {
                            var bsAlert = new bootstrap.Alert(alert);
                            bsAlert.close();
                        }
                    });
                });
                
                // Força posicionamento correto do dropdown
                userDropdown.addEventListener('shown.bs.dropdown', function() {
                    var dropdownMenu = userDropdown.nextElementSibling;
                    if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                        dropdownMenu.style.position = 'absolute';
                        dropdownMenu.style.zIndex = '999999';
                        dropdownMenu.style.top = '100%';
                        dropdownMenu.style.right = '0';
                        dropdownMenu.style.left = 'auto';
                        dropdownMenu.style.transform = 'none';
                        dropdownMenu.style.minWidth = '200px';
                        
                        // Debug: log para verificar se está sendo aplicado
                        console.log('Dropdown configurado:', dropdownMenu);
                    }
                });
            }
            
            // Inicia auto-dismiss
            autoDismissAlerts();
        });
    </script>
</body>
</html>